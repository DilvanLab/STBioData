(ns geoqb.core
    (:require [cljsjs.material-ui]
              [cljs-react-material-ui.core :refer [get-mui-theme color]]
              [cljs-react-material-ui.reagent :as rui]
              [cljs-react-material-ui.icons :as ic]
              [reagent.core :as reagent :refer [atom]]
              [geoqb.components :as comps]
              [testdouble.cljs.csv :as csv]
              [cljs-time.core :as time]
              [ajax.core :as ajax]))

(def mui-conf {:mui-theme (get-mui-theme {:palette {:primary1-color (color :green500)}})})
(defn get-mui-conf [color] {:mui-theme (get-mui-theme {:palette {:primary1-color (color color)}})})
;; -------------------------
;; Def`s
(def app-state (atom {:sparql-query nil
                      :progress {:qb false
                                 :download false}}))

(def csv-file (atom nil) )
(def rdf-describe (atom nil) )

(def responseAtom (atom {}))

(def endpoint "http://java.icmc.usp.br:2190/repositories/bio")
(def prefix (str "PREFIX bioprov: <http://java.icmc.usp.br/bioprov/> \n"
                  "PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> \n"
                  "PREFIX geo: <http://www.opengis.net/ont/geosparql#> \n"
                  "PREFIX geof: <http://www.opengis.net/def/function/geosparql/> \n"
                  "PREFIX prov: <http://www.w3.org/ns/prov#> \n"
                  "PREFIX dwc: <http://rs.tdwg.org/dwc/terms/> \n"
                  "PREFIX ogc: <http://www.opengis.net/ont/geosparql#> \n"
                  "PREFIX uom: <http://www.opengis.net/def/uom/OGC/1.0/> \n"
                  "PREFIX foaf: <http://xmlns.com/foaf/0.1/> \n"))

(def data-table (atom ()))

(def qb-expand (atom false))

(def start-datePicker (atom ""))
(def end-datePicker (atom ""))

(def qb-progress (reagent/cursor app-state [:progress :qb]))
(def download-progress (reagent/cursor app-state [:progress :download]))

(def drawer-status (atom false))
(def statitics-bol (atom false))
(def stat (atom ()))
(def progress (atom "hidden"))
(def progress-data-sets (atom "inline-block"))
(def progress-country (atom "inline-block"))
(def progress-years (atom "inline-block"))

(def list-state (atom {:species [] :properties [] :regions []}))

(def yasqe (atom (comps/yasqe " ")))
;;---------------------------
;; GMAPS

(def mymap (atom ()))
(def mymarkers (atom #js []))
(def markers-cluster (atom nil))
(def markers-spyder (atom nil))
(def obj-polygon (atom nil))
(def obj-polygon2 (atom nil))
(def user-position (atom ()))

(defn create-marker "Create a marker in specific map"
  [varmap lat long title content]
  (let [marker (js/google.maps.Marker. (clj->js {:map varmap
                                    :position (google.maps.LatLng. lat, long)
                                    :title title
                                    :icon "imgs/markers/marker.svg" }))
        infowindow (js/google.maps.InfoWindow. (clj->js {:content content}))]

        (.addListener marker "click" (fn [] (.open infowindow varmap marker)))
        (.push @mymarkers marker)
        (reset! mymarkers @mymarkers)
        (.addMarker @markers-spyder marker)
        marker ))

(defn create-polygon "Create a polygon in specific map"
  [varmap cords polygon]
  (let [color (rand-nth ["#f44336" "#9C27B0" "#3F51B5" "#03A9F4" "#FF9800" "#FF5722" "#795548" "#607D8B"])]
    (if-not (nil? @polygon)
            (.setMap @polygon (clj->js nil)) )
    (reset! polygon (js/google.maps.Polygon.
                                    (clj->js {:paths cords
                                              :strokeColor color
                                              :strokeOpacity 0.8
                                              :strokeWeight 2
                                              :fillColor color
                                              :fillOpacity 0.20    })))
    (.setMap @polygon @varmap)
  )
)

(defn remove-markers "Remove markers from map"
  []
  (dotimes [i (count @mymarkers)] (.setMap (get @mymarkers i) (clj->js nil)) )
  (if-not (nil? @markers-cluster) (.clearMarkers @markers-cluster) )
  (reset! mymarkers #js []) )

(defn map-render "Map container"
  []
  [:div#map {:style {:height "470px"}}
   ])

(defn home-did-mount "After mount the map, this function is executed"
  [this]
 (def map-canvas (reagent/dom-node this))
 (def map-options (clj->js {"center" (js/google.maps.LatLng. -15.794410 -47.877821)
                            "zoom" 4}))
 (reset! mymap (js/google.maps.Map. map-canvas map-options))
 (.getCurrentPosition js/navigator.geolocation
   (fn [position] (reset! user-position (js/google.maps.Circle. (clj->js {"strokeColor" (color :green700)
                                                                          "strokeOpacity" 0.8
                                                                          "strokeWeight" 2
                                                                          "fillColor" (color :green200)
                                                                          "fillOpacity" 0.35
                                                                          "radius" 25000
                                                                          "map" @mymap
                                                                          "center" (js/google.maps.LatLng.
                                                                                     (-> position (aget "coords") (aget "latitude"))
                                                                                     (-> position (aget "coords") (aget "longitude"))) }) ))
                  (.setCenter @mymap (js/google.maps.LatLng. (-> position (aget "coords") (aget "latitude")) (-> position (aget "coords") (aget "longitude"))))
                  (.setZoom @mymap 7) ))

)

(defn create-map "Render the map" [] (reagent/create-class {:reagent-render map-render :component-did-mount home-did-mount}))

;;---------------------------
;; Functions
(defn alert [str] (js/alert str) )

(defn update-list! [list type f & args]
    (apply swap! list update-in [(keyword type)] f args))

(defn add-item! [list type c]
  (update-list! list type conj c))

(defn populate-atom [list type elements]
  (dotimes [i (count elements)]
    (add-item! list type {:name (get elements i) :checked false})))

(defn handler-species-list [response]
  (doall (let [result (-> (comps/json->clj response) (get "results") (get "bindings"))]
        (dotimes [i (count result)] (add-item! list-state "species" {:name (-> (get result i) (get "scientificname") (get "value")) :checked false}) ))))

(defn consult-species-list []
  (populate-atom list-state "properties" ["Within" "Intersects"] )
  (populate-atom list-state "regions" ["Amazon Forest" "Atlantic Forest" "Caatinga" "Cerrado" "Ja√∫ National Park" "Mapinguari National Park" "Pampa" "Pantanal" "Pico da Neblina National Park"] )
  (ajax/GET (str "http://java.icmc.usp.br:2190/repositories/" "Animalia") {
    :params {:query "PREFIX dwc: <http://rs.tdwg.org/dwc/terms/>
                      SELECT DISTINCT ?scientificname
                      where {
                        ?code dwc:scientificName ?scientificname
                      } ORDER BY ?scientificname"}
    :handler handler-species-list
    :error-handler #(js/console.log %)
  })
)

(defn response-to-csv [response]
    (reset! csv-file [["ID" "scientificname" "kingdom" "phylum" "class" "order" "family" "genus" "institutionCode" "Status IUCN" "POINT (lat long)" "country" "dateCollected" "nameCollected" "dateCataloguing" "nameCataloguing" "Same as GBIF" "Same as IUCN"]] )
    (dotimes [i (count response)] ^{:key i}
      (reset! csv-file (conj @csv-file [(-> response (get i) (get "CodSpecie") (get "value"))
                                        (-> response (get i) (get "scientificname") (get "value"))
                                        (-> response (get i) (get "kingdom") (get "value"))
                                        (-> response (get i) (get "phylum") (get "value"))
                                        (-> response (get i) (get "class") (get "value"))
                                        (-> response (get i) (get "order") (get "value"))
                                        (-> response (get i) (get "family") (get "value"))
                                        (-> response (get i) (get "genus") (get "value"))
                                        (-> response (get i) (get "institutionCode") (get "value"))
                                        (-> response (get i) (get "occurrenceStatusIUCN") (get "value"))
                                        (-> response (get i) (get "pontowkt") (get "value"))
                                        (-> response (get i) (get "country") (get "value"))
                                        (-> response (get i) (get "dateCollected") (get "value"))
                                        (str "\"" (-> response (get i) (get "nameCollected") (get "value")) "\"")
                                        (-> response (get i) (get "dateCataloguing") (get "value"))
                                        (str "\"" (-> response (get i) (get "nameCataloguing") (get "value")) "\"")
                                        (-> response (get i) (get "sameAsGBIF") (get "value"))
                                        (-> response (get i) (get "sameAsIUCN") (get "value") (str " "))]
                              ))
    )
)

(defn download-csv []
  (if-not (nil? @csv-file)
          (comps/save-file (str "Data.csv") "text/csv" #js [(csv/write-csv @csv-file)] )
          (alert "No results")
))

(defn download-rdf []
  (if-not (nil? (:sparql-query @app-state))
          (do
            (reset! download-progress true)
            (ajax/GET (str "http://java.icmc.usp.br:2190/repositories/" "Animalia") {
              :params {:query (clojure.string/replace  (clojure.string/replace (:sparql-query @app-state) "SELECT" "DESCRIBE") #"#" "%23")}
              :handler (fn [response]
                          (comps/save-file "Data.n3" "text/n3" #js [response])
                          (reset! download-progress false))
              :error-handler (fn [response] (js/console.log (str "erro: " response)))
              }))
          (alert "No results")
))

(defn region-polygon [region]
  (cond
    (= "Amazon Forest" (:name region)) "'Polygon((-16.2026415759079 -60.1942741348379,-16.1626116246649 -60.1542441835949,-15.0818029411052 -60.7546934522392,-14.7615633311616 -60.4344538422956,-13.8809044038166 -60.6346035985104,-13.7207845988448 -61.1149630134258,-13.3605150376582 -62.1157117944997,-12.8401256714998 -62.9963707218446,-12.680005866528 -63.7569397954608,-12.3597662565843 -64.7576885765346,-11.9194367929119 -65.1980180402071,-11.2789575730246 -65.4782276989077,-9.99799913325009 -65.4782276989077,-9.87790927952123 -65.9986170650661,-10.1981488894649 -66.7992160899252,-10.7985981581092  -67.799964870999,-11.0788078168098 -68.1202044809427,-11.0788078168098 -69.0008634082877,-11.0788078168098 -69.8815223356326,-11.1188377680528 -70.6420914092487,-10.078059035736 -70.9623310191924,-10.118088986979 -72.123199605238,-9.63772957206351 -72.3633793126957,-9.4776097670917 -73.3240981425266,-8.99725035217626 -73.1239483863119,-8.11659142483128 -73.8044575574421,-7.47611220494403 -74.0846672161427,-6.5554233263561 -73.2440382400407,-6.11509386268361 -73.2440382400407,-5.11434508160978 -72.8437387276112,-3.99350644680708 -70.8422411654635,-4.19365620302185 -70.0416421406044,-1.11134995731443 -69.6413426281749,-0.270720981212412 -70.2017619455763,0.649967897375517 -70.0416421406044,1.0102374585621 -69.4411928719601,1.0102374585621 -70.0016121893615,1.93092633715003 -69.8815223356326,1.97095628839298 -68.5605339446152,2.49134565455137 -67.3596354073266,2.25116594709365 -67.2795755048407,1.41053697099163 -66.9193059436541,1.05026740980505 -65.9585871138232,1.93092633715003 -64.2372992103762,2.41128575206547 -63.9971195029185,4.37275336297018 -64.9178083815064,4.05251375302656 -63.0764306243305,4.33272341172723 -62.2758315994715,4.81308282664267 -60.954843208454,5.05326253410039 -60.7546934522392,5.41353209528697 -60.9148132572111,5.49359199777288 -60.2343040860809,4.61293307042791 -59.6338548174365,4.25266350924132 -59.4337050612218,3.61218428935407 -59.5137649637077,2.97170506946682 -59.7539446711654,2.01098623963593 -59.4737350124647,1.53062682472049 -58.7932258413345,1.81083648342117 -58.2328065239332,2.17110604460775 -57.3121176453453,2.13107609336479 -56.2713389130285,2.49134565455137 -56.3513988155144,2.77155531325205 -55.790979498113,2.811585264495 -54.7902307170392,2.57140555703728 -54.4299611558526,2.57140555703728 -54.0296616434231,2.45131570330842 -53.1490027160781,2.61143550828023 -52.8287631061345,3.61218428935407 -52.1882838862472,4.29269346048428 -51.7879843738177,4.61293307042791 -51.3076249589022,4.57290311918495 -50.9873853489586,3.97245385054065 -50.7872355927438,3.09179492319568 -50.5870858365291,1.77080653217821 -49.4262172504834,1.33047706850573 -49.5463071042123,0.810087702347331 -49.5863370554552,0.169608482460076 -47.8250192007653,-0.590960591156039 -46.7041805659626,-0.751080396127852 -44.662653052572,-1.95197893341646 -44.0622037839277,-2.19215864087418 -43.4617545152834,-3.39305717816278 -43.8220240764699,-3.35302722691983 -44.2623535401424,-3.91344654432117 -44.4224733451142,-4.75407552042319 -45.0229226137586,-4.63398566669433 -45.3831921749451,-4.95422527663796 -45.463252077431,-5.63473444776817 -46.1437612485612,-5.51464459403931 -46.7442105172055,-5.59470449652522 -47.7849892495223,-6.71554313132791 -47.9050791032512,-7.87641171737356 -48.4254684694096,-8.79710059596149 -48.3454085669237,-9.31748996211988 -48.7457080793532,-8.75707064471854 -48.8657979330821,-8.43683103477491 -49.1860375430257,-10.4783585481655 -50.3068761778284,-10.4783585481655 -50.9873853489586,-11.0387778655669  -51.3476549101452,-11.5591672317253 -51.1475051539304,-11.9194367929119 -51.54780466636,-13.6407246963589 -51.9080742275465,-13.4405749401441 -52.6286133499197,-13.6006947451159 -54.069691594666,-13.6407246963589 -54.6301109120674,-13.480604891387 -55.2705901319546,-12.8000957202568 -55.3906799856835,-12.3197363053414 -55.9110693518419,-12.3197363053414 -56.3113688642714,-12.7600657690139 -56.3513988155144,-13.3204850864152 -56.7917282791869,-13.6006947451159 -57.4322074990741,-13.2003952326864 -57.5923273040459,-12.8801556227427 -57.9525968652325,-12.3997962078273 -58.0726867189614,-11.5591672317253 -58.5530461338768,-11.5991971829682 -59.7539446711654,-12.5599160127991 -59.9540944273802,-12.9602155252286 -59.9140644761372,-13.6407246963589 -59.3936751099788,-13.7608145500877 -59.5938248661936,-14.0009942575454 -59.5537949149506,-14.5614135749468 -59.3136152074929,-14.9216831361334 -58.8732857438204,-15.0017430386193 -58.4329562801479,-14.6414734774327 -58.1527466214473,-14.0410242087884 -57.8325070115037,-13.7608145500877 -57.0719379378875,-14.2411739650032 -56.671638425458,-15.2819526973199 -57.1119678891305,-16.0425217709361 -57.5923273040459,-16.0024918196931 -58.3128664264191,-15.8023420634783 -58.7932258413345,-16.2426715271508 -59.233555305007,-16.2026415759079 -60.1942741348379))'^^ogc:wktLiteral))"
    (= "Atlantic Forest" (:name region)) "'Polygon((-5.1599532926972 -35.5589385523339,-5.52402876232907 -35.3313914374315,-6.20667010210629 -35.1948634146944,-7.02583969154553 -34.9673165926917,-7.79949969348428 -34.921807635161 -8.30010306524149 -35.058336373066,-9.0737626099479 -35.4224126548874,-9.80191251119471 -35.9230173291803,-10.1204778332917 -36.3781122001154,-10.5300618352681 -36.8787166132694,-10.7576084797517 -37.1517735713343,-11.2127019928463 -37.4248307703857,-11.6222862275944 -37.5613595779083,-12.4869635908218 -38.1529834748109,-12.8510381237899 -38.4715500899283,-12.5779816723629  -38.6990970019363,-12.6690002882225 -38.7901160154236,-12.8510377347444 -38.790116245381,-12.9875655341107 -39.0176636688902,-13.3516403987586 -39.0176641473183,-13.4881683505637 -39.1086832298514,-13.8522431867881 -39.1086837292184,-14.2163179424735 -39.1541936936524,-15.1720143126408 -39.1086856630623,-16.2187292391369 -39.063177883624,-16.9013688400443 -39.3362357694532,-17.5384994696604 -39.3362369081429,-17.8570644506725 -39.5182753162531,-18.1301200819821 -39.700313650993,-18.6762316923432 -39.8368430794613,-19.2223434139875 -39.8823536392111,-19.5409085268789 -39.927863757644,-19.7684546517499 -40.1554115191982,-20.1780379864765 -40.3829596862668,-20.5421119739169 -40.6105077757083,-20.8606765308343 -40.8835652341837,-21.1792413387417 -41.0200943450291,-21.4978061227301 -41.1566234722769,-21.8618803711953 -41.2021338194472,-21.9528987568955 -41.2931529556128,-22.1804446070194 -41.5662102550869,-22.407990230395 -41.9302864661536,-22.68104562533 -42.0668155392252,-22.7265547001508 -42.1578345646815,-22.7720620919942 -42.9770047911992,-22.9085884256041 -43.6141374183396,-22.9085871258927 -44.1602507440348,-22.9085861423875 -44.5698357156654,-23.0451130659777 -44.9339116170484,-23.4091862922607 -45.297988172641,-23.4546945290742 -45.7075732344151,-23.6822389717661 -46.4357248539991,-23.8642750494939 -46.7998008593279,-23.9552921214593 -47.3459142888522,-24.3648748739424 -47.5279532948854,-24.7744570857624 -47.8920300415927,-25.0475113939833 -48.3016157813451,-25.4570934939644 -48.665692573305,-26.048713115449 -48.8022229283428,-26.6403330762493 -48.8022250798755,-27.0954254570446 -48.7567173536294,-27.4594993708681 -48.7112093142165,-27.4594995102 -48.6656998854297,-27.9601004978354 -48.8022301256469,-28.3696830072419 -48.9387600536894,-28.7337552439411 -49.3938558370793,-29.370881884006 -50.0764999470815,-29.7349545683086 -50.3495580972137,-29.7804622218255 -50.8046525398528,-29.6894432109022 -50.9866898207274,-29.5074034806826 -51.8513679531818,-29.6894383582375 -52.3974817412994,-29.68943549615 -53.2166511158615,-29.6439240662458 -53.853782574621,-29.5073949107374 -54.3088759531584,-29.4163754206237 -54.6274413196558,-29.4163744496647 -54.9004976970567,-29.4163741252593 -54.9915164871301,-29.370865756579 -54.7639692988381,-29.4618863737232 -54.1268381428298,-29.4618881358551 -53.6262347191361,-29.0523067244922 -53.2621576316536,-28.7792509646762 -53.444194035624,-28.5517036167025 -53.8537776474962,-28.5517029933795 -54.035815244523,-28.233136499299 -54.6729453960212,-28.1421168801404 -55.0370201383943,-28.0510977297334 -55.2645666930857,-27.7325349666676 -54.8094714162541,-27.4139726006411 -54.2178479655665,-27.2774462133378 -53.8537722365815,-26.4582811991481 -53.6717313613541,-25.9576798040369 -53.7172388156991,-25.5936057235912 -53.8537656148735,-25.5936062858487 -53.6717280421865,-25.1385144601288 -53.5807075694954,-24.8654586357268 -53.7627441467215,-24.9564766486382 -53.8992726502965,-25.2750408442703 -53.9902926014073,-25.366058000149 -54.3998774488743,-25.4570758476097 -54.581915343422,-24.8199477775392 -54.3088566595235,-24.501383297953 -54.3088555132036,-24.0462911598001 -54.3088539096198,-23.8642538982692 -54.4453814361164,-23.6367072889446 -54.6274181922696,-23.5001791134896 -54.80945525859,-23.4546687122437 -55.2190395314837,-23.6367064956927 -54.9004744887403,-23.7732341386106 -54.9004749586063,-23.7732329370778 -55.3100593865156,-23.7277234578495 -55.4010779871156,-23.1361034226179 -55.4920947237661,-22.6810110042001 -55.5831119662943,-22.3624472369968 -55.3100546748844,-22.3169385201636 -55.128017019486,-22.2714300503739 -54.8549606020448,-22.1804114780447 -54.900469693138,-21.9983743326661 -54.9914878779607,-21.9073558830728 -54.9914875937732,-21.9528659718712 -54.672922081832,-21.7253199577542 -54.6274119990231,-21.7253215360758 -54.0357900357739,-22.0893966022452 -53.5806972990881,-22.1349071749705 -53.0800941647346,-22.1349080238992 -52.7615284268512,-21.9528721576333 -52.3519433353912,-21.2702345851959 -51.9423567704939,-20.8606517066281 -51.8058274196027,-20.5420871831431 -51.7148077436328,-20.1780140382097 -51.3507315868219,-19.677412744545 -51.1231832836201,-19.0402836981422 -50.8501252845503,-18.6306999030852 -51.0321618688427,-18.7217189377141 -50.804615105552,-18.4941730935843 -50.5770675682064,-18.448664413865 -50.3040110649517,-18.3576462607754 -50.1219732488901,-18.4486656840883 -49.7123888441725,-18.2211195966835 -49.5758601042489,-18.4941754449693 -49.484841931222,-18.3121392051243 -49.0752568576101,-18.0845929980748 -48.9842375243591,-18.1756127849067 -48.3926154204525,-18.312140631825 -48.3926157301646,-18.4486685713824 -48.3471066318739,-18.7672343049407 -47.9830320718315,-18.7672341123573 -48.0740508981361,-18.585196509622 -48.3015975356138,-18.5396866540943 -48.5746538934703,-18.539686173181 -48.8022009391154,-18.3576489618608 -48.8477099260252,-18.5396852061568 -49.2572950114564,-18.72172201403 -49.393823658256,-18.8127397706877 -49.7578991122443,-18.6307019915272 -50.076464494155,-18.767229106606 -50.3950306273291,-18.9947751438535 -50.5315593816134,-19.2223210636105 -50.7135975428245,-19.4953764362637 -50.8046170298319,-19.8139407340728 -51.0321648429208,-19.9959779819849 -50.9411465228092,-19.7229234798527 -50.4860518127983,-19.8139433681401 -49.8944298100388,-19.813943785418 -49.7123921897036,-19.8594535720851 -49.4848452745399,-20.086999901255 -49.4848458596725,-20.3145467538084 -49.2572994107117,-20.4510745468628 -49.2572997693101,-20.1325089552556 -49.575864792083,-19.9959805303249 -49.8489208741218,-20.1325076832899 -50.1219776568396,-20.2235257777541 -50.3040155100663,-20.4965813332012 -50.3040162378446,-20.633110087349 -49.894431962242,-20.7696396033716 -49.1662817971084,-20.3145470712986 -49.120771182302,-20.4510753974207 -48.8932244863845,-20.8151499444763 -48.7111878011593,-20.9971871076069 -48.6656788766121,-20.9971865650144 -48.8932259419938,-21.2247323222357 -49.1207736236878,-21.4067692472056 -49.1662835397029,-21.5888062777503 -49.1662840496315,-22.2259375669619 -48.4836446476928,-22.4989926372506 -48.6656831121057,-22.08940900145 -48.8022101670299,-21.8163527856154 -49.075265869102,-21.998389007675 -49.3938322779819,-22.2714442901772 -49.4848518980697,-22.2714448693325 -49.2573048366726,-22.3624617400664 -49.8944368623846,-22.3624591417348 -50.8956438064103,-22.1349123306164 -51.123190135672,-22.0438936067994 -51.2142086667163,-22.2259299847736 -51.4417562163262,-22.4989856700538 -51.350738246222,-22.4989869904247 -50.8501348165797,-22.6810250406218 -50.4405507218017,-22.7720444866516 -50.0764757351611,-22.8175543293922 -49.8489288243339,-22.7720455594905 -49.6668910411852,-22.9540831424736 -49.4393445333799,-23.272648104938 -49.3483266873166,-23.5912128144656 -49.3483276859821,-23.7277395565829 -49.7124034354268,-23.9552851307888 -49.9399512356415,-24.2283396654483 -50.2585180175971,-24.273848134376 -50.5315746329515,-24.5013945532077 -50.4405565770465,-24.5924139189855 -50.1219910009222,-24.4558876211298 -49.6213869852181,-24.5013977454393 -49.3028212202248,-24.0918157139679 -48.8932351141591,-24.0007980904802 -48.5746688830133,-24.0007990695318 -48.210593509548,-23.7277427410151 -48.529158596814,-23.5912163231095 -48.0285545336912,-23.3181608204801 -48.0285536944023,-22.9540857467913 -48.4381373769508,-22.9085777791498 -47.937533616075,-22.7720508217185 -47.6189672545147,-22.2714489782086 -47.6189658038857,-21.8163568031199 -47.4369268336344,-21.9528851465107 -47.2093800982495,-22.2714496524574 -47.3459092662281,-22.5900143615667 -47.3914196047165,-22.5900151555102 -47.0728536295343,-22.3624699646355 -46.6177587111728,-21.679830317409 -46.8908133748588,-21.2702471109861 -46.7997934219584,-20.9971914821698 -46.7997927014733,-20.7241357388949 -46.8453014158564,-20.6331171904665 -46.8453011818851,-20.8606640807169 -46.617754648498,-20.8606655298443 -45.9806226777835,-20.997193979884 -45.7075664534796,-21.0882131538814 -45.4345101027522,-20.7696486046842 -45.2524715660979,-20.4510834299011 -45.3434896348525,-20.2690460981486 -45.4345080478921,-20.0870096479797 -45.115941591962,-20.3600651617296 -45.2069611177737,-20.4965932119789 -45.1159425901511,-20.3600663464193 -44.6608479248997,-19.9959924300651 -44.4788093152622,-19.8139547906242 -44.7063560540924,-19.5864080527797 -44.8428838192249,-19.5864081477152 -44.7973743874103,-19.9049740413913 -44.3877902315874,-19.904974804038 -44.0237147465882,-19.9049757500645 -43.5686203692606,-19.859466643206 -43.4776013860431,-19.5409017538323 -43.3865817817176,-19.3133555346256 -43.2500529552533,-18.9492808580196 -43.3865804719945,-18.8127526847311 -43.523108488651,-18.7217339915959 -43.5686177293304,-18.4486781726555 -43.5686171474293,-18.403169564922 -43.204541555851,-17.9480766593454 -43.1135217431777,-18.0390958703122 -42.7949558590818,-17.7660401698816 -42.7039364325058,-17.9025686063924 -42.4308800642971,-17.3109478372827 -42.248841145985,-16.8103453279718 -42.248840205121,-16.8103457947722 -41.9757835622776,-16.4462712104078 -41.9757829015333,-16.446270829757 -42.2033301014412,-16.1277054853131 -42.2488389730555,-15.9001588564762 -42.2488385752769,-15.9911778056208 -42.0668009779499,-15.8546503364984 -41.7482346622826,-15.2630279724245 -42.4308752430636,-15.5815929820489 -42.6129135247263,-15.1720090994923 -42.5674034003065,-15.1265004749475 -42.112308958036,-14.9444637663359 -41.7027237156872,-14.9899737198445 -41.2931388235942,-14.8079369772541 -40.8835535557197,-14.5348814593908 -40.5194775857528,-14.0797883947229 -40.246420242071,-13.7157138545066 -40.0643819406502,-13.6246949102356 -40.2464195928086,-13.4881666778521 -40.3829477345605,-13.3516385060763 -40.4739664324532,-13.1696016325328 -40.0643811897035,-13.0785832159535 -39.8368338421796,-12.9420554931781 -39.5637769853975,-12.6689994010029 -39.5182671866672,-12.6689996798 -39.2907199512837,-11.9863591942927 -39.3362285577926,-11.9408500397158 -39.1541907159303,-12.3049251672546 -38.9721533620271,-12.3049255948337 -38.6080777670378,-11.849831928052 -38.608077227507,-11.8498322857837 -38.2895110751989,-11.7588137480312 -38.1074731653879,-11.485757763439 -37.8799255988066,-11.0306641557286 -37.7433967501609,-10.8486269218054 -37.4703398427517,-10.4390428497702 -37.1062637992813,-10.0749676913429 -37.1972823569597,-10.0749678180035 -37.0607539947599,-10.1204774986536 -36.7421878522343,-9.84742141871249 -36.4691308628613,-9.71089316914048 -36.5601496524326,-9.25579929528901 -36.5146397987569,-8.93723357600837 -36.4691300767198,-8.84621474912568 -36.514639458037,-8.6641772374831 -36.423620400767,-8.43663069971844 -35.8319972855338,-8.16357429184484 -35.8319970814119,-8.16357425862303 -35.877506539013,-8.16357425862303 -35.877506539013,-8.02704627946953 -35.5589402331239,-7.61746166285293 -35.5134304886562,-7.52644284898188 -35.5134304272646,-7.25338648860614 -35.3769018719989,-6.93482064434249 -35.331392213063,-6.7527830507252 -35.2403731852373,-6.52523598308416 -35.2403730520569,-6.11565119544018 -35.3313917408931,-5.66055702007013 -35.3313915046768,-5.20546271338258 -35.5589385732042,-5.1144438510355 -35.6044479882898,-5.1599532926972 -35.5589385523339))'^^ogc:wktLiteral))"
    (= "Caatinga" (:name region)) "'Polygon((-2.84126341463766 -40.9575875193954, -2.79206350056833 -40.5885871896426, -2.76746361953623 -40.1211867633182, -2.8904637506865 -39.8505865444458, -3.11186396910162 -39.456986227884, -3.57926441394849 -38.7681856732999, -3.65306452650161 -38.5467854620756, -4.36646513086021 -37.8579849630643, -4.66166544625889 -37.4397845969404, -4.88306563675628 -37.2429844577751, -4.93226577147601 -36.9969841786552, -5.12906601370774 -36.6771838685855, -5.10446620739593 -36.2343832868974, -5.07986634081167 -35.9145828528492, -5.12906651472245 -35.5947824431432, -5.37506672408174 -35.4471823546516, -5.81786704919113 -35.2749823333962, -5.96546708583224 -35.3487825133372, -6.18686717903156 -35.3733826664773, -6.38366726815527 -35.3733827757678, -6.55586739905478 -35.2749827356921, -6.77726749039739 -35.2749828659404, -6.94946748155806 -35.3979831441253, -7.02326756923161 -35.2995830507558, -7.19546758315229 -35.3733832636081, -7.29386753610973 -35.4963835002314, -7.46606755531411 -35.545583682437, -7.58906762253891 -35.4963836957286, -7.56446778024039 -35.2503833298163, -7.68746768233506 -35.4471836931311, -7.9826676329326 -35.6193841423667, -8.08106749358479 -35.8407845224454, -8.08106735106192 -36.0375847937271, -8.2040673698998 -36.0375848843338, -8.2040674965307 -35.8653846467645, -8.27786758076994 -35.7669845644829, -8.42546739879613 -36.0375850509969, -8.64686717194741 -36.3573856590215, -8.76986700190974 -36.5787860543735, -8.8436669437353 -36.6525862123896, -9.06506692137988 -36.6771864278792, -9.06506704315909 -36.5295862305456, -9.01586716431358 -36.3819859904675, -9.18806712261647 -36.4311862008771, -9.33566705569394 -36.5049864263852, -9.48326704737278 -36.504986554218, -9.58166697597998 -36.5787867404894, -9.6062669308306 -36.6279868286084, -9.80306693173301 -36.6033869719385, -9.90146676410955 -36.7755872935103, -9.99986674903638 -36.7755873844749, -10.0490668986806 -36.6033871978127, -10.0244670813008 -36.4065869060092, -10.0490671674318 -36.3081867928872, -10.1474670191052 -36.455787088018, -10.1720668335796 -36.6525873798044, -10.0982665963367 -36.9231876736503, -9.97526655072144 -36.9969876561685, -9.92606651438363 -37.0461876752196, -10.0244662920563 -37.2675880562055, -10.0982661384141 -37.4151883165345, -10.221266178821 -37.3413883393552, -10.4426660508088 -37.4151886507738, -10.5902660566215 -37.3659887338144, -10.5902659358899 -37.4889888929586, -10.5410659025264 -37.5381889068751, -10.6886658564629 -37.5381890556297, -10.9100656570051 -37.6611894409627, -10.9346654722579 -37.8333896856095, -11.1068653788166 -37.8579898986183, -11.3528651696784 -37.9563902884785, -11.5742651198976 -37.9071904704978, -11.7218650481016 -37.9071906361299, -11.7218649129487 -38.0301907924268, -11.6972648172254 -38.1285908885155, -11.8448645201403 -38.3253913027097, -11.9432643818016 -38.3991915081409, -12.0908642113127 -38.4729917725378, -11.9186641454513 -38.6205917504229, -11.967864004128 -38.718991927083, -12.1400638408377 -38.7681921906948, -12.3122636718283 -38.8173924576728, -12.4352635016438 -38.8911926969242, -12.1400635264279 -39.038792513043, -11.9678634964047 -39.16179245092, -11.9678631551324 -39.4569927894262, -12.189263089303 -39.383192972697, -12.3614630844443 -39.2847930704454, -12.3860628901685 -39.43239327103, -12.2630627154562 -39.6537933697179, -12.2384626161914 -39.7521934491043, -12.3860624756501 -39.7767936597234, -12.6566625668337 -39.530793723762, -12.9518620528109 -39.7521943568406, -13.1486614741491 -40.0719949750122, -13.3454610693159 -40.244195430813, -13.3946607629777 -40.4409957114374, -13.4930606344323 -40.4655958742818, -13.6652606291136 -40.3425959823477, -13.7144607792068 -40.1949958894321, -13.9358606246304 -40.1457961493266, -14.4524596983442 -40.4163972082845, -14.6246591137894 -40.6869977658723, -14.6492588346709 -40.8591979890521, -14.796858223 -41.1543985295797, -14.9936576452358 -41.3757990694367, -15.0182567923487 -41.9169996490359, -15.141256133388 -42.2368001546741, -14.944455875176 -42.5812001493272, -14.7722560380256 -42.6303999145222, -14.7968557033873 -42.8272001265803, -14.9444551907895 -43.0240005358982, -15.1166549798229 -42.9994007994262, -15.2888548045609 -42.9502010449412, -15.5348544367825 -42.9502014624782, -15.7562538975638 -43.07320195257, -15.9530535479567 -43.097802319814, -15.928453260774 -43.2946024461317, -15.7070535314388 -43.3438020980124, -15.461053795715 -43.4176017330398, -15.2642539012939 -43.5406014968274, -15.4610535168522 -43.5898018731601, -15.8054526830973 -43.7620026133606, -16.0760520280484 -43.8850031962559, -15.9776520271063 -43.9834030956535, -15.6086526778411 -43.9588024201559, -15.4610531970335 -43.7866020293212, -15.1904535820089 -43.8112015845539, -15.0920536165477 -43.8850014744959, -15.0674534586575 -44.0080015255693, -15.2642530704527 -44.0572018971653, -15.4610525538322 -44.1802023288573, -15.5594521490829 -44.3278026094339, -15.6086518220696 -44.4754028024295, -15.5102519458742 -44.5000026460589, -15.3380526327817 -44.2540021693069, -15.0920532237211 -44.1310016581271, -14.7968536815012 -44.1310011630828, -14.6246538665696 -44.1802009145505, -14.4278541236553 -44.2048006118561, -14.3540542330199 -44.2048004930213, -14.3294544190916 -44.1064003840123, -14.6000542843831 -43.9342006957421, -14.8214540682629 -43.8604010038543, -14.969053883358 -43.8358012305191, -14.895254227051 -43.6882009943004, -14.8706545328424 -43.5160008185678, -14.7968548321403 -43.393000599113, -14.5016552927685 -43.3684001020541, -14.1818557369236 -43.368399597079, -13.9112560658754 -43.3929991986675, -13.6406563860989 -43.4175988086536, -13.4438565693414 -43.4667985539941, -13.2716568554817 -43.4175982649557, -12.9518574142459 -43.2945977140715, -12.5582580339121 -43.1715970750792, -12.0662584773795 -43.2453964751009, -11.7956586693624 -43.3191961803639, -11.525058974574 -43.2945958217268, -11.1806595118046 -43.1223952753027, -11.131459327919 -43.3191953588417, -11.0576591971144 -43.4913953916273, -10.8608594387545 -43.4421951248326, -10.6886595958094 -43.4421949249705, -10.5410599454043 -43.2453946191057, -10.3934600977938 -43.2207944362219, -10.1228603459084 -43.1961941220186, -10.1720600433046 -43.4421943456343, -9.99986013272126 -43.4913941923455, -9.70466034214787 -43.5159938966091, -10.0490597786575 -43.7865944387808, -10.0490596999234 -43.8603944856859, -9.82765991265333 -43.8357942323882, -9.77845972277331 -44.0571943168881, -9.68005967807695 -44.1801942864828, -9.33566037709346 -43.761993677909, -9.18806060694306 -43.6389934531817, -9.114260967667 -43.3191931715447, -8.9420613138176 -43.073192838395, -8.52386158855155 -43.0485924348376, -8.32706154861283 -43.2207923761705, -8.22866147589267 -43.3683923870199, -8.10566150290444 -43.4175923121005, -7.9334615766174 -43.4421921811062, -7.73666174050517 -43.3683919702153, -7.51526192734727 -43.2699917279031, -7.34306204394687 -43.2207915607398, -7.24466204910396 -43.2699915168733, -7.26926196301262 -43.3683915987561, -7.31846186484979 -43.4667916988089, -7.3922617341207 -43.5897918326609, -7.61366154412956 -43.6881920695517, -7.85966134976432 -43.7619923173116, -8.13026127751942 -43.6635924884131, -8.35166105697748 -43.7619927439336, -8.5730607804282 -43.9095930341647, -8.52386076861166 -43.958793018234, -8.37626088805901 -43.9341928695781, -8.20406101927919 -43.909592701713, -8.08106111615343 -43.8849925797076, -7.95806121042378 -43.8603924594124, -7.76126132333433 -43.8603922938051, -7.6382614513551 -43.7865921487517, -7.3184617313995 -43.6389918049606, -7.0232620141331 -43.442191459132, -6.77726207891629 -43.491391309881, -6.53126222351611 -43.4175910911677, -6.50666235048335 -43.2453909659838, -6.72806237742201 -43.0977910245974, -6.70346245516956 -42.9993909421918, -6.53126254468934 -42.950190789941, -6.30986262608513 -42.9255906247383, -6.1868626273885 -42.9747905770811, -6.08846260593953 -43.0485905623791, -6.23606254971546 -43.0731906737584, -6.21146247633391 -43.1961907371079, -6.11306240948674 -43.3437907663899, -5.94086244325012 -43.3683906722983, -5.79326255801298 -43.2453905045407, -5.64566262220834 -43.1961903848908, -5.57186271035017 -43.0731902630054, -5.3504627654123 -43.0485901207, -5.12906282644604 -42.9993899677554, -5.25206290337575 -42.8271899211512, -5.22746296038241 -42.7287898416626, -5.30126299190721 -42.6549898317317, -5.22746302740916 -42.6057897576467, -4.88306305732306 -42.6057895773696, -4.73546301705363 -42.7041895707623, -4.6124630350092 -42.6795894945872, -4.44026307414676 -42.6057893638404, -4.21886308428233 -42.5811892480052, -4.16966302972077 -42.7041893097801, -4.16966298685477 -42.8025893751176, -4.0712629650827 -42.8517893653155, -3.92366296239253 -42.8517893040773, -3.84986298976994 -42.7779892259743, -3.75146304265142 -42.6303890889637, -3.579263056058 -42.5565889738932, -3.45626303396709 -42.5811889459562, -3.38246308589406 -42.4089888020122, -3.3332631383695 -42.2367886641077, -3.28406318859637 -42.0645885235137, -3.13646322319583 -41.8677883300027, -2.86586312160831 -41.990788338479, -2.81666312366103 -41.9415882880498, -2.8904631714635 -41.8431882362977, -2.86586322287771 -41.6463880798224, -2.89046328054286 -41.4741879530987, -2.84126341463766 -40.9575875193954))'^^ogc:wktLiteral))"
    (= "Cerrado" (:name region)) "'Polygon((-2.93500088252176 -41.5286478899651,-2.85269178768657 -41.8578840170525,-2.81153721794187 -42.1048111112315,-2.77038260236137 -42.516356262179,-2.72922803618439 -42.7632833396748,-2.56460995515531 -43.1336739161165,-2.44114638689052 -43.4629099796697,-2.48230082587355 -43.6686825443508,-2.81153664597963 -44.0390732226779,-3.05846358960226 -43.9979187905063,-3.22308151124874 -44.0802278631087,-3.26423589681408 -44.3683094340869,-3.5523171938987 -44.6152365809416,-3.88155304913828 -44.6152367121847,-4.33425223175966 -44.8210094430852,-4.49886998024802 -45.1502455624692,-4.62233338523414 -45.1914001278966,-4.41656078930325 -45.6440995616533,-4.62233313453908 -45.6852541655426,-4.91041443715914 -45.6852543160093,-5.15734121296109 -45.7675634563984,-5.32195891930843 -46.0556450600633,-5.4042676554423 -46.3848811079999,-5.28080403938967 -46.7552715188725,-5.36311276867108 -47.0845075411057,-5.28080364661992 -47.4137434526205,-5.36311236759765 -47.7429794508643,-5.28080327447307 -48.0310608458389,-5.32195768242627 -48.1133698532558,-5.61003885501602 -48.1545245244583,-5.85696556003031 -48.1956791776309,-6.26851012537342 -48.1545249727418,-6.6800547364151 -48.0310618033372,-6.96813588927337 -48.0310620288764,-7.33852575422518 -48.2368347928945,-7.66776128516619 -48.2779895695019,-7.50314329052922 -48.524916369819,-6.96813565867187 -48.3191434696501,-6.68005451530045 -48.3191432430572,-6.84467218287177 -48.4837613329341,-6.9681354601601 -48.5660704112557,-7.1739076590437 -48.6072250694689,-7.58545203481393 -48.6895344011168,-8.07930545464356 -48.5660713812539,-8.53200425559961 -48.6072263093758,-8.778930967575 -48.5249175771363,-9.14932063818205 -48.771844908207,-8.7377762386073 -48.8129989668496,-8.49084941171918 -49.0187711624552,-8.24392270673159 -49.1010798962799,-8.40854017400966 -49.3891614679509,-8.77893000186624 -49.4714708169082,-8.94354743121838 -49.7595523901661,-9.23162821986727 -49.9653251256584,-9.47855464930344 -50.0887888542299,-9.84894457611342 -50.0064803148393,-10.0547167476007 -49.9653260756941,-10.5074154512853 -49.9241721492567,-10.8366508199123 -49.9241725718109,-11.0835772834145 -49.9653273836079,-11.2893493192808 -50.0064821471867,-11.6597390099807 -50.047637147197,-11.7832023115039 -50.0064828366257,-12.194746506102 -49.965328948773,-12.4005180253761 -50.3357196298163,-12.7709075176504 -50.4591836556963,-12.8532161435913 -50.5826472388301,-12.8943702346899 -50.7884197228056,-12.4828259911961 -50.9118825264026,-12.0712819146769 -50.911881903818,-11.4951203955022 -50.7472631428102,-11.1247306178109 -50.788417112663,-10.8778040735527 -50.8295712624464,-10.507414581603 -50.6237983722895,-10.3427969054493 -50.623798164001,-10.3016422333225 -50.8295705189888,-10.1370240574003 -51.2411151108105,-10.2604871569391 -51.3645787000184,-10.5897227419786 -51.158806726893,-10.8366493381748 -51.076498091471,-11.0012667780037 -51.2411162304561,-10.8366489101745 -51.4057339246483,-10.9189575194203 -51.5703519467201,-10.7543396568558 -51.7349696347358,-10.9189571395315 -51.8584332845048,-11.2893471605523 -51.6115069325113,-11.6185826603985 -51.4468894862015,-11.8243545251473 -51.5703532205526,-11.9066631614115 -51.6938167759352,-12.3593616737135 -51.652662981574,-12.8532142459839 -51.8172816722609,-13.2236037723848 -51.8584367564351,-13.5939931418511 -51.9819008160754,-13.3059113723829 -52.5992174672265,-13.4293735381598 -53.216534770817,-13.5939901998509 -53.7515431672271,-13.5116809435617 -54.0396242977994,-13.4293712760208 -54.5746322065197,-13.1824449721579 -54.5746317777974,-13.223599152164 -54.6980952395884,-13.3882164782235 -54.8215589152813,-13.3882161319103 -55.0273312266043,-13.1412899085597 -54.98617633525,-12.8943639414875 -54.7804036042339,-12.688592144049 -54.6980943358232,-12.5239746602245 -54.6569396030741,-12.5651289181045 -54.739248595636,-12.7709006529454 -54.8627123221344,-12.8943636746795 -54.9450214528272,-12.9766722411449 -55.0684849764267,-12.8120543736653 -55.2742570006403,-12.8532084890019 -55.4388749078568,-12.6474362460956 -55.6446468545815,-12.4005100792996 -55.5623375321624,-12.3182011180788 -55.685800771376,-12.2770463484301 -55.9327274442445,-12.0712744328571 -55.9327271142203,-12.0301198595138 -56.056190415049,-12.1124283706532 -56.2208083647026,-12.1947369413237 -56.3442718587883,-12.3593544630683 -56.3442721265492,-12.6062805396109 -56.4677358963227,-12.7708979151458 -56.5500450806104,-13.0178243776813 -56.4265821446412,-13.22359583631 -56.673509224875,-13.3059040899617 -56.9615905348972,-13.3882125486641 -57.1262084858208,-13.5939843980981 -57.1262088600883,-13.5939839641376 -57.373135559278,-13.4705207153616 -57.4554442310228,-13.3470578230095 -57.3319806605281,-13.2235943605418 -57.5377526818138,-12.9766682801991 -57.4554433488399,-12.9766677945107 -57.7435244807406,-12.9766675858667 -57.8669878195856,-12.9355130087183 -57.9904510840498,-12.8532042025811 -58.0316053851685,-12.6885867948625 -57.9904506552604,-12.6062783258696 -57.8258327326655,-12.3593516313808 -58.1139134307293,-12.1124252073221 -58.237376352848,-11.7420356659851 -58.3608390836036,-11.5774179231094 -58.5254565910045,-11.4951088658428 -58.731228665575,-11.4951084910975 -58.9781553016557,-11.4951081153405 -59.2250819295085,-11.5362624216339 -59.2662364312985,-11.5774167904356 -59.2662364961614,-11.8243426758139 -59.4720090741222,-11.9066513428557 -59.5131636439451,-12.0301139115712 -59.8423993276153,-12.153576866813 -59.9247084012877,-12.2358855906236 -59.9247085396804,-12.6885834864749 -59.9658637530038,-12.8532006386516 -60.1304817787507,-13.0178184236583 -59.9247099048512,-12.8532009916244 -59.9247096098286,-12.4005033077216 -59.7600910815449,-12.1124229031866 -59.677781725435,-11.8243429987122 -59.2662368905332,-11.9066520574664 -59.0604648343487,-11.9478068798961 -58.7723838259873,-11.947807138947 -58.6077660636429,-12.0712704447426 -58.4843029405309,-12.1947338180813 -58.3196853743292,-12.4005056678789 -58.3196857174278,-12.4828142041232 -58.4431491845096,-12.6474312652917 -58.6900761166564,-12.8943570388171 -58.9370031910677,-13.0589741363929 -59.1427756814652,-13.3470542259127 -59.3897028357658,-13.5116715116418 -59.4720120166911,-13.7174432958811 -59.4720124047851,-13.8820607193431 -59.4720127199,-13.7585972765295 -59.6777846685046,-13.7585969755019 -59.8424024125859,-14.0055234789979 -59.6366307085153,-14.2112954008234 -59.5543222381635,-14.4582217526487 -59.4308594171264,-14.7051481840671 -59.2662421625851,-14.993228969077 -59.1016249978737,-14.9520752648046 -58.7723893782431,-14.9109215544996 -58.4431537446928,-14.581687253148 -58.1550719594028,-14.4170698941154 -58.1139171856632,-14.2936072735485 -57.866990264053,-14.0878362147621 -57.4554453845922,-14.0466825965271 -57.0439008032063,-14.0878373368935 -56.8381286214826,-14.3759182884093 -56.6323569083055,-14.5816902009803 -56.5912028562475,-15.0343877463864 -56.8381304880342,-15.157850674403 -56.920439648228,-14.9520785450802 -57.0850570366623,-15.1578502732081 -57.1262119111356,-15.3636218306536 -57.2496756957998,-15.5282388532191 -57.4554482998808,-15.6517017573732 -57.5377574654866,-15.692856029866 -57.5789120044848,-15.8163192641876 -57.496603371902,-16.0220906976512 -57.6612216253505,-16.2278629798222 -57.4142953797458,-16.1044001742345 -57.2908317488865,-16.0220917185878 -57.1673682097068,-16.1455550418817 -57.0439051235302,-16.186709568791 -56.9615963074896,-16.186709825027 -56.8381329444868,-16.0220929864777 -56.5500513939494,-15.8163217688587 -56.2619697504444,-15.6928589290542 -56.1385061133949,-16.0220944121229 -55.8504256078069,-15.98094046521 -55.6446532164651,-16.1867127025768 -55.4388813547034,-16.3924846043342 -55.3977273445483,-16.392485197575 -55.1096460994363,-16.515948630423 -54.9450285131295,-16.7217206226282 -54.8627200415284,-16.8863379895049 -54.9038748801263,-16.8040288308112 -55.1096470203227,-16.96864627776 -55.1096473960205,-17.2155726187025 -55.0273390363607,-17.5448075843075 -54.9861853460849,-17.5036529552509 -55.1096486462874,-18.0386598724815 -54.9861865416494,-18.3678947130007 -54.9861873603276,-18.6971291548075 -55.1508060663077,-19.0263641549126 -55.0684979865506,-19.3144444016156 -55.150807685166,-19.7259874656178 -55.3154266713315,-20.1786838946177 -55.8504359992684,-20.4256100347615 -55.8092822409195,-20.3021464928349 -56.015054211198,-20.0963742772546 -56.2208259420611,-19.8906023754871 -56.3031342858443,-20.2609909969589 -56.4677531873915,-20.1786817977907 -56.6735252567049,-19.9729098031755 -56.7969880492177,-19.849446065139 -57.0850689099698,-20.0140628793073 -57.2908416650227,-20.1786802115795 -57.2908421388381,-20.302143741512 -57.0850702082302,-20.5902246057031 -56.879298756058,-20.7959963734989 -56.8381449065562,-21.0017682471682 -56.7558366025518,-21.042921918189 -57.0027634907617,-20.8783040522798 -57.2085352890515,-20.9194580518585 -57.3319987878833,-20.9606121597364 -57.4143078279139,-21.2486917769531 -57.6612354527556,-21.866006278412 -57.7847007695852,-22.1540869846008 -57.6200838725746,-22.1952429320722 -57.0439215698709,-22.1952440879019 -56.6323769435761,-22.1540904526783 -56.3854500240905,-22.3187090230544 -55.9327514217926,-22.5244812361524 -55.7269797449119,-22.6890992408783 -55.4800534604949,-22.565636141751 -55.5212075282958,-22.3187111962136 -55.1508164878709,-22.2775570920176 -55.0685074113994,-22.401020769981 -54.8215809636524,-22.3187122181855 -54.7804262268093,-22.2775573189041 -54.9861984653255,-22.0306310968417 -55.0685066307204,-21.866013762079 -55.0685061163663,-21.9071689879645 -54.7392704595474,-21.7425521955991 -54.5334975792536,-21.7425530750198 -54.2042617726276,-21.9894798795411 -53.9161811864183,-22.0717896624923 -53.5046366408486,-22.1129447744073 -53.2165553938375,-22.0717922906696 -52.5169290284982,-20.3844665454608 -51.4469074875533,-19.2321457825743 -50.8295871276612,-18.8206019873266 -50.8707405990969,-18.28559637667 -50.2945764426904,-18.409060301754 -49.9241862929772,-18.1621346359609 -49.6361042550607,-18.4502157348141 -49.4303324424432,-18.4090618779395 -49.1834053618594,-17.9975187307718 -48.8541684328316,-18.3267546657845 -48.442624175165,-18.6971444732025 -48.2780070202202,-18.5736806259557 -48.6072427496447,-18.5736799279749 -48.9364787525551,-18.8206054142059 -49.306869825019,-18.6971418339307 -49.5126420180465,-18.8206044305701 -49.7595692908813,-18.9852217536852 -49.8418786803362,-18.8206037109 -50.0888052501184,-19.0675294994033 -50.2945783210395,-19.1909922471362 -50.4591965987576,-19.5202271151026 -50.5003519191773,-19.767152467073 -50.8707429831231,-19.8083073113732 -50.6649706295863,-19.6848450626148 -50.2945798704111,-19.7671545570974 -49.9653441189504,-19.7260008445612 -49.6772625359304,-19.6436921006892 -49.6772623273504,-19.8083102449303 -49.3891812564371,-19.9317736440022 -49.2657180723714,-20.3844718218686 -49.2245647447382,-20.2198536713807 -49.5126458144116,-20.2198529995977 -49.8007273038241,-20.4256239615659 -50.1711183210826,-20.5490865648467 -50.3768911312386,-20.6313955883475 -50.2534278665897,-20.5490871549404 -50.1299641555182,-20.5902424024141 -49.759573787711,-20.6725520156708 -49.3891835118134,-20.7548612394105 -49.1834112263176,-20.5902442494663 -48.9776382766034,-20.4256265762236 -49.0599468470641,-20.6725533761662 -48.8130204824927,-20.9194800809607 -48.6072486200369,-21.2487152278713 -48.524940500708,-21.4133325984869 -48.5660954590127,-21.3721775336338 -48.8541768827643,-21.2487143355797 -48.8953310466031,-21.5779487537388 -49.1011044815638,-22.0306475621038 -48.7718697281002,-22.5656550908341 -48.4426352230493,-22.6891176456383 -48.6484081309863,-22.0718014090836 -48.9776423752141,-22.0306465317165 -49.183414779696,-22.236417704521 -49.4303424008539,-22.4010351355756 -49.430342886258,-22.4010346076358 -49.636115401163,-22.4010322649249 -50.5415144028516,-22.4010314051167 -50.870750377462,-22.1541048690483 -51.0353676153627,-22.0306417071949 -51.0765217414933,-22.2364128192255 -51.3234493203532,-22.4833389130618 -51.3234500711547,-22.5244934791052 -51.2411412093366,-22.5244940227249 -51.0353687355483,-22.6891127251257 -50.54151527793,-22.7302682673088 -50.0888159095434,-22.7302696651708 -49.5538073822286,-22.9771962218635 -49.3891901164974,-23.2241227775114 -49.2245728539239,-23.6356660778723 -49.3068831550282,-23.8825920652183 -49.3480384496969,-23.9237456281941 -49.6361201254495,-24.1295175890598 -49.5538117828251,-24.2118255986223 -49.8007390872743,-24.006053530701 -49.9242019262516,-24.2529786824059 -50.253438767499,-24.4587499288622 -50.4180574668878,-24.6645220980445 -50.2534401514138,-24.4999050827706 -50.1299760830973,-24.2118261680797 -49.594966558764,-24.2941356561846 -49.306885279498,-23.9649019924299 -48.8953391244215,-23.8825943978815 -48.4837937581954,-23.7179759956736 -48.8541838292373,-23.6356677300271 -48.6895655322629,-23.5945153346904 -47.9487841942242,-23.4710520480282 -48.0310928396902,-23.553359350393 -48.566101744767,-23.4298962863652 -48.5661013611965,-23.3475884386301 -48.2368650214429,-23.1418165440867 -48.278018905196,-23.1418153656003 -48.7307185123592,-22.9771988979559 -48.3603274289477,-22.8125827219817 -47.8664728028134,-22.2775766115056 -47.6195441725833,-21.9071874082987 -47.5783886132494,-21.701415563666 -47.5783880413009,-21.5779529470165 -47.3726151417043,-21.2898723430136 -47.3726143606369,-21.2898728281306 -47.1668417985018,-21.660262181969 -47.1668428016894,-22.030651716108 -47.084534797519,-22.3598862602283 -47.2491537856339,-22.6068118409678 -47.496081581836,-22.6891211889693 -47.2491547339782,-22.4833501751899 -46.9199180141225,-21.9483436714123 -46.7964529610424,-21.4544907108857 -47.0022241870831,-20.919484119817 -46.8787592259731,-20.5902488143573 -47.0022219136832,-20.7548676401225 -46.4260591390662,-20.9194859088678 -46.0968234294732,-21.0429497060459 -45.808742119342,-21.084104741554 -45.5206605862247,-20.7548700449016 -45.3560416656428,-20.4256347794763 -45.438349885265,-20.0963994146495 -45.5618126364706,-20.014091700032 -45.0679582013732,-20.1787096133756 -44.9033405114763,-20.4256356798272 -45.0268046774794,-20.3021729599394 -44.8210317656487,-20.1787102310325 -44.6152588534088,-19.8494748338942 -44.7387216386733,-19.6848571754765 -44.7798757744049,-19.6437032113151 -44.574103068351,-19.8494753536773 -44.4917945026425,-19.8083223317611 -43.8333220107239,-19.6437056693821 -43.3806218350872,-19.232161498648 -43.4629299674364,-19.1086982112232 -43.504084221628,-18.6971536159449 -43.7921650041248,-18.4913816760155 -43.751010039227,-18.2856099641689 -43.5863915070753,-17.8740661930906 -43.4217725598154,-17.7917580570945 -43.0513816630079,-17.9152215954748 -42.8867638035638,-17.6271411557603 -42.6398360640183,-17.5448327701139 -42.392908732014,-16.9275164342801 -42.4340620825375,-16.5159723686222 -42.3517522691363,-16.3513542647504 -42.5986791328884,-15.9809647949594 -42.3929058430392,-15.7751928001646 -42.3105964327453,-15.8575020521088 -42.0636694107032,-15.5694209919532 -42.1048234470021,-15.3636483939871 -42.392904786875,-15.240184849703 -42.5575226821684,-14.9521037173245 -42.6398312566816,-14.6640227025384 -42.6398307919399,-14.8286401745768 -42.8044491506399,-14.9932575084235 -43.0513765565046,-15.2813386285676 -42.9690679908168,-15.6105739005415 -43.0513775979496,-15.3224923985625 -43.3806132824696,-15.1990287959581 -43.5863856769282,-15.4459552719445 -43.6275406188881,-14.9521019211058 -43.7921578602243,-14.7051759389901 -43.4217667769008,-14.5817129049066 -43.2571484950611,-14.5817132799082 -43.0102213663664,-14.2936318318815 -43.2983025582215,-13.758624032921 -43.4217652933312,-12.6886089602289 -43.2159911542744,-12.1947556603578 -43.2159904886257,-11.7009021253914 -43.3806079212152,-11.4128211521865 -43.2571440101413,-10.9189680516676 -43.0102163123698,-10.5485783454235 -42.6809797409838,-10.5485781648826 -42.8455978158023,-11.0835856629464 -43.1748345771244,-11.3305121104526 -43.3806074603351,-10.0547240972307 -43.4217605086175,-9.7254883740613 -43.5040691895298,-9.72548828949405 -43.5863782186816,-10.0958783317682 -43.6275331279726,-9.64317904224673 -43.915614241884,-9.43740606197307 -44.6152407194769,-8.82008964551686 -44.2036950037486,-8.40854528405963 -43.9567675532125,-8.03815502465418 -44.0802307597347,-7.70891928820673 -44.1213849916901,-7.2973749305771 -43.7509940597484,-6.6389034842667 -43.6686845476633,-6.55659471313726 -43.4217574154664,-6.26851358999511 -43.1336756263134,-6.10389552802616 -43.3806026000641,-5.89812312399016 -43.4217569826277,-5.69235088946465 -43.174829778569,-5.40426960727793 -43.0513660698108,-5.28080623417717 -42.9279024582416,-5.28080634780016 -42.7221298836634,-4.86926151495334 -42.7221296668905,-4.37540759360304 -42.9279020029875,-4.005017228716 -42.8867473275316,-3.79924481875687 -42.8044382156203,-3.30539110089808 -42.3105838496386,-2.97615533151644 -41.6932659792978,-2.93500088252176 -41.5286478899651))'^^ogc:wktLiteral))"
    (= "Ja√∫ National Park" (:name region)) "'Polygon((-1.98455254212069 -63.4361231313596, -2.12625175287864 -63.5999628437985, -2.22366996027473 -63.6132471448071, -2.25023856229185 -63.7505182552288, -2.31223196699845 -63.7903711582545, -2.40522207405836 -63.7416620545565, -2.44507497708403 -63.9276422686763, -2.56463368616105 -63.9896356733829, -2.56020558582487 -63.7903711582545, -2.78161060263416 -63.7239496532117, -2.83031970633221 -63.6619562485051, -2.7373295992723 -63.5025446364024, -2.70190479658282 -63.3519892249721, -2.77718250229798 -63.2457148169036, -2.84803210767695 -63.1970057132056, -2.82589160599602 -62.9888849974049, -2.94987841540923 -62.873754388664, -2.98087511776253 -62.825045284966, -2.88788501070263 -62.6434931711824, -2.72404529826375 -62.4353724553816, -2.52478078313538 -62.0811244284867, -2.48492788010971 -61.9172847160479, -2.40079397372217 -61.8995723147031, -2.39636587338599 -61.7667293046175, -2.27680716430897 -61.7268764015919, -2.26352286330041 -61.5896052911701, -2.21481375960236 -61.5674647894892, -2.0775426491806 -61.5807490904977, -1.95355583976739 -61.5276118864635, -1.93584343842265 -61.4523341807483, -1.8871343347246 -61.3682002743608, -1.77643182631995 -61.3947688763779, -1.63030451522582 -61.4124812777227, -1.56831111051921 -61.4833308831016, -1.5417425085021 -61.5231837861273, -1.65687311724293 -61.5187556857911, -1.634732615562 -61.611745792851, -1.6657293179153 -61.780013605626, -1.74100702363047 -61.9704219200821, -1.72329462228572 -62.0722682278144, -1.75871942497521 -62.2405360405894, -1.825140930018 -62.3910914520198, -1.81185662900944 -62.4398005557178, -1.86499383304367 -62.5106501610968, -1.81185662900944 -62.5549311644586, -1.73657892329428 -62.6479212715185, -1.70115412060479 -62.7674799805955, -1.71443842161335 -62.8693262883278, -1.80742852867325 -63.015453599422, -1.89156243506079 -63.2634272182484, -1.98455254212069 -63.4361231313596))'^^ogc:wktLiteral))"
    (= "Mapinguari National Park" (:name region)) "'Polygon((-7.58139395901241 -64.4932068242082,-7.7163645154731 -64.5067038798542, -7.79734684934951 -64.524699954049,-7.85133507193378 -64.565191120987,-8.01329973968661 -64.6641695290584, -8.30573594535143 -64.655171491961,-8.51269079859115 -64.5921852322793,-8.52618785423722 -64.5516940653411,-8.64766135505183 -64.6596705105097,-8.4452055203608 -64.8081381226164,-8.41821140906867 -64.8756234008468,-8.51269079859115 -64.8891204564928,-8.56218000262673 -65.190554699255,-8.74214074457431 -65.4829909049199,-9.05707204298258 -65.6719496839648,-9.19204259944327 -65.3255252557157,-9.31351610025789 -65.4469987565303,-9.4799797865594 -65.451497775079,-9.59695426882533 -65.4110066081408,-9.54296604624105 -65.1635605879629,-9.59245525027664 -65.0780792355378,-9.51147291640023 -64.8306332153599,-9.16504848815113 -64.6101813064741,-8.96709167200879 -64.524699954049,-8.85461620829155 -64.2862519709684,-8.76913485586645 -64.2547588411276,-8.52168883568853 -64.191772581446,-8.24274968566978 -64.0927941733748,-8.08528403646564 -64.1017922104722,-7.87832918322592 -63.7148766152849,-7.90082427596937 -63.6248962443111,-7.66237629288882 -63.5754070402755, -7.60388905175586 -63.5754070402755,-7.54090279207421 -63.7148766152849,-7.51390868078207 -64.3672343048448,-7.58139395901241 -64.4932068242082))'^^ogc:wktLiteral))"
    (= "Pampa" (:name region)) "'Polygon((-30.1699107918945 -57.5815681333967, -30.0549510232861 -57.4248026840618, -29.981794782014 -57.3307433946753, -29.8354817484569 -57.2889387086242, -29.7727766368777 -57.1426245128675, -29.6787186164644 -57.0172121491303, -29.5951112275219 -56.975407776473, -29.5115041810774 -56.8395444732679, -29.4487988267025 -56.755936233191, -29.386093166046 -56.7559359350623, -29.3651915451131 -56.6827788872789, -29.2711331656988 -56.6514254646637, -29.1248202527894 -56.5678168360851, -29.0830169273196 -56.4424047270203, -29.0412133000128 -56.4006005608393, -28.9471548745297 -56.3796981391702, -28.9471550239584 -56.3378941672932, -28.9053514691014 -56.2751880162578, -28.8112929286243 -56.2856385771009, -28.8008420951849 -56.2542855501436, -28.7694895940807 -56.1602264687809, -28.6231768038525 -56.034813884815, -28.5291183310488 -56.0243624668393, -28.4977658974241 -55.9094013993542, -28.4873150614797 -55.8780483721984, -28.3828056025749 -55.8780479045498, -28.3828059306973 -55.7839889635295, -28.3932569860925 -55.7526360294852, -28.3828062220426 -55.7003810148809, -28.3514534198118 -55.689929881745, -28.2260418828232 -55.7421842937003, -28.1737875484933 -55.6272231340315, -28.1633368545746 -55.5540661322549, -28.090180443418 -55.4913598488537, -28.1006316060209 -55.4286539315224, -28.1006318575356 -55.355496973894, -28.14243596884 -55.2614382099146, -28.1946909915334 -55.1778304847297, -28.2051421901595 -55.1046735698516, -28.173789707334 -55.00016348766, -28.2051427284675 -54.947908651523, -28.3410052941569 -54.8747522838333, -28.3619072605101 -54.853850386024, -28.2678488428014 -54.8224969884315, -28.2260451606576 -54.791143820913, -28.2051435160471 -54.7179867649528, -28.3096530269152 -54.7075362265842, -28.4037118408384 -54.6239286779898, -28.4664178487852 -54.5298699957743, -28.4664180644675 -54.4671640227954, -28.4246143461673 -54.446261847867, -28.3828109137894 -54.3417517084259, -28.4977718762269 -54.1849872751127, -28.6022815687365 -54.1222817589917, -28.623183751519 -54.0386738816002, -28.6336349506019 -53.9655169533968, -28.5604782797189 -53.9759676275903, -28.5604786733356 -53.861006667036, -28.5604788877838 -53.7983006877635, -28.6127336997164 -53.7773989239575, -28.7172438248475 -53.5892814411847, -28.7172440753633 -53.5161244618341, -28.7590479396752 -53.4952226518531, -28.8740088711894 -53.348909197836, -28.8949109468713 -53.2966543029771, -28.9994205718761 -53.2548507767789, -29.0516752400325 -53.275753005108, -29.1352826426811 -53.3280083676522, -29.2188901158048 -53.3593617366663, -29.2815954013949 -53.4743229934755, -29.2920461667392 -53.5265780282642, -29.375653598861 -53.5683823981579, -29.4383590618538 -53.6310886689818, -29.5115155435954 -53.6728929939539, -29.5115146233878 -53.9341679233466, -29.4801614150264 -54.0386777477151, -29.3547497619695 -54.1222851446784, -29.2920436413114 -54.2476968151762, -29.3338471694124 -54.3208539812146, -29.3024940723322 -54.3940108108355, -29.2188863907949 -54.4253634161363, -29.1979842773046 -54.4880692966265, -29.2606896234791 -54.5821285470487, -29.2711400894111 -54.7179915398917, -29.271139645361 -54.8434034866191, -29.229335639737 -54.9061092664922, -29.1561789813842 -54.9165599256482, -29.0934731209773 -54.9688146145245, -29.0098655525705 -54.9688142328083, -29.0412186117198 -54.9061084046573, -29.0307679597132 -54.8225003947159, -28.9471603892262 -54.8225000149236, -28.8112983404469 -54.7493424342877, -28.7590429874655 -54.9270091173651, -28.6545330118905 -55.0733225767895, -28.5813760950342 -55.1569302067928, -28.5291209260257 -55.2823419070771, -28.5082186328891 -55.3973027507089, -28.5186692877089 -55.4809107503218, -28.5709242377194 -55.4182050195172, -28.6231790052323 -55.4077542597297, -28.6858846819599 -55.4077545418365, -28.6858853768784 -55.2091856480003, -28.7694932762805 -55.1151270724686, -28.8635518656778 -55.0942255079249, -28.8844534642062 -55.1778335609686, -29.0307668181809 -55.1464812430269, -29.1875311158317 -55.1151289775135, -29.2815895891946 -55.125580406812, -29.3965500264645 -55.1151299453233, -29.4592561466482 -54.9897182944793, -29.4383547401696 -54.8538552562199, -29.4801590439302 -54.7075415111242, -29.4174537404298 -54.6030312615785, -29.4906105473956 -54.5507766208636, -29.5637676889535 -54.4044630144111, -29.52196431296 -54.2895018600873, -29.511513477922 -54.2581488222409, -29.5951215661931 -54.1118352570158, -29.6473773343122 -53.8192075833089, -29.6682798184873 -53.6519917222218, -29.730985867637 -53.5474820368418, -29.7309863841487 -53.4011680675405, -29.8145946594608 -53.2025994911963, -29.845948200104 -53.0040306664587, -29.8250470401013 -52.7950105952768, -29.8459494112433 -52.6591477048985, -29.793695075396 -52.5441864737954, -29.8564011632131 -52.4292257692435, -29.7832446015718 -52.4083234347158, -29.8041474429309 -52.1365975401151, -29.783245619188 -52.1156954450523, -29.7205397125063 -52.1784011580721, -29.6369321624726 -52.1679497787826, -29.6996386113613 -51.9484790659826, -29.7623445911509 -51.8648713494456, -29.7623447716716 -51.8126163482726, -29.6787371107745 -51.8335179702076, -29.6160315263872 -51.8021646868213, -29.6264839440418 -51.3736737131015, -29.6264846928894 -51.1542026926265, -29.6264849064073 -51.0914966855577, -29.6578377905559 -51.0810458242074, -29.699641588444 -51.0810460110602, -29.7518964782092 -51.0392422397665, -29.7205438080734 -50.9869870923046, -29.7727985554317 -50.9869873263517, -29.8773083350906 -50.9033797834593, -29.9400141384066 -50.8720270610811, -29.8355052147813 -50.7048105616061, -29.8355055704452 -50.6003005416423, -29.8355057480702 -50.5480455310998, -29.8773099024737 -50.4435356956659, -29.9818195782804 -50.3912811521468, -29.8773103989411 -50.2972216616661, -29.814604804596 -50.265868374737, -29.7937030454959 -50.2240642716506, -29.7937033629229 -50.1300052478435, -29.7728016382876 -50.0777501415674, -29.657841288004 -50.0463966262523, -29.5846847731496 -50.0045922943314, -29.4801755779768 -49.9105328133741, -29.3652153235717 -49.8478262983077, -29.3234116912372 -49.7955711038375, -29.3129608434704 -49.7642180502234, -29.3652155312935 -49.7851202811628, -29.4697248007752 -49.8582777537704, -29.5951358986749 -49.9523373261549, -29.7309979419436 -50.0463969485056, -29.9086637801442 -50.1404567617004, -30.1385843585332 -50.2345168188048, -30.3998578080203 -50.3181260304135, -30.6715818279427 -50.5062453371554, -30.8701494454099 -50.6212072984396, -31.120971420189 -50.8406795471499, -31.3299894720514 -51.0915046162006, -31.5703604938466 -51.300525839956, -31.7271237755871 -51.5513506696793, -31.894337680474 -51.8857835689368, -31.9988465148198 -52.0530001246135, -32.1138065978292 -52.1366087239262, -32.1138064036913 -52.1888637310934, -32.0929042425521 -52.2620206331717, -32.1033550315861 -52.3038246917883, -32.2601187674301 -52.4187865138449, -32.3541770286933 -52.4814930097735, -32.4586863491912 -52.5128465596564, -32.5004901240748 -52.512846779071, -32.7722147341632 -52.4919462135779, -32.7931160638698 -52.6382603437463, -32.9603307915559 -52.7323202520677, -33.2634071951474 -52.9726949278206, -33.5246797612085 -53.2235203983716, -33.6814433046013 -53.3698352897091, -33.6814428513461 -53.4847962975941, -33.6082862235974 -53.4952468859078, -33.5560318882205 -53.4011875870476, -33.3052092550569 -53.4116371905576, -33.1379941886887 -53.4116362687308, -33.11709295381 -53.2444201471735, -32.9916819312885 -53.1712624594351, -32.8662707035476 -53.1503597792461, -32.8035655294116 -53.0249474346371, -32.8662713456347 -52.9831437690539, -32.9916823342296 -53.066752452901, -33.0334862647464 -53.0249486767289, -33.0021337996965 -52.9308894986197, -32.9289772018724 -52.9308891029956, -32.9498792475812 -52.8890852121207, -32.908075917511 -52.7741239752772, -32.7513120525378 -52.7009661276572, -32.6781556489339 -52.6487107327083, -32.3959802535123 -52.6278072427548, -32.2078632639843 -52.627806262508, -32.1347068510226 -52.5755508798233, -32.1660599570776 -52.5023940355006, -32.0197471255589 -52.3978832729661, -31.9361396463165 -52.376980843708, -31.8420811049096 -52.3874313661249, -31.8420813367489 -52.324725360479, -31.8734344803835 -52.241117511019, -31.9465910944423 -52.2411178828547, -31.9674934095313 -52.1261569751269, -31.9256899770131 -52.0320977498499, -31.9047880483132 -52.0425486453596, -31.8525332072123 -52.0739013850984, -31.8525333996338 -52.0216463780512, -31.8420828387427 -51.9171363100763, -31.7793776644365 -51.7812729729223, -31.6957705571321 -51.655860532949, -31.5181051953022 -51.4572906149018, -31.4972037179369 -51.342329488772, -31.2986363319234 -51.1751124828243, -31.1941269364481 -51.1542099722481, -31.0896174273909 -51.1646604710728, -31.089617910341 -51.028797441841, -30.9433049406625 -50.9451887244522, -30.9119524291315 -50.8511295538486, -30.8283450660814 -50.7884231436192, -30.7760905087928 -50.7361678849914, -30.5357188780575 -50.6839117500416, -30.3998565448391 -50.6839111218096, -30.4521114698563 -50.6316563508128, -30.4625625272965 -50.6003033916022, -30.326700299649 -50.5689497591348, -30.211739931031 -50.5480472289435, -30.1490341635874 -50.56894894843, -30.0758773032154 -50.6316546301476, -30.1699358467964 -50.6316550572634, -30.1908375654405 -50.6839101636414, -30.2535432959534 -50.6734594477824, -30.2639938121327 -50.7988715217151, -30.2953466587434 -50.7988716655707, -30.3057971009397 -50.9451857417198, -30.3371496929231 -51.0183428993085, -30.232639989435 -51.0810484283283, -30.1594830230868 -51.1751071065285, -30.0967771140864 -51.2378128277107, -30.002718575396 -51.2378123983628, -29.9295619333114 -51.2378120658308, -29.8668559879985 -51.3109687896459, -30.0340711328831 -51.3214205511047, -30.2221882065093 -51.3214214142473, -30.3057957931521 -51.3214218004988, -30.3580506437183 -51.2900690384739, -30.3371489658077 -51.2273629327094, -30.3998547284026 -51.2064612203722, -30.3476002780693 -51.1228529650983, -30.4939129692837 -51.290069670981, -30.6820300310601 -51.2900705539178, -30.7760885600357 -51.2900709985222, -30.7551865910162 -51.310972902958, -30.6297751083187 -51.3423253158033, -30.6193240501983 -51.3736782712087, -30.7133824315885 -51.4154827211208, -30.8387938010845 -51.4154833164059, -30.8910482035011 -51.5095425796774, -31.0164596058636 -51.499092179502, -31.0687140791468 -51.5722494423111, -31.1836740430335 -51.6976620172388, -31.2254778290712 -51.6976622207939, -31.2254775279291 -51.7812702320332, -31.1941246134208 -51.8021720817549, -31.2568300275037 -51.8753293968309, -31.3195354397998 -51.9484867127497, -31.4553973570249 -52.0529973946275, -31.5494558299736 -52.0634488630148, -31.5076517804726 -52.1366056625992, -31.6330631263174 -52.1366062884091, -31.6957683760536 -52.2515676146104, -31.7584737386961 -52.3351759382649, -31.6748658705055 -52.4187835231228, -31.8629827623195 -52.4501374774515, -31.9883940588675 -52.4605891181478, -31.9988448867492 -52.4919421742835, -32.0301974085538 -52.5755503415462, -32.0615502414584 -52.5755505027354, -32.0929025663654 -52.7114136732159, -32.1556078778292 -52.8054730025796, -32.2287644846707 -52.8054733826398, -32.3123719556191 -52.8263758198888, -32.4064304476822 -52.8263763127599, -32.4482339049559 -52.9099845375283, -32.4795863780243 -53.0040437074571, -32.5422919971431 -53.0144950398056, -32.5945463937303 -53.098103320763, -32.5945459949059 -53.2026133237887, -32.5527416249448 -53.3593781023251, -32.4377805765001 -53.5370444868436, -32.3646237382551 -53.5997500959354, -32.1765064493591 -53.6833570981406, -32.0510948562636 -53.7565134346077, -31.9570359336312 -53.8714739312591, -31.8316237079062 -54.1118462445329, -31.7271135669211 -54.2999636682101, -31.6644073957866 -54.4358263148871, -31.5076430941612 -54.4776294973919, -31.3926816976532 -54.7493548359564, -31.3404264318708 -54.8956685243677, -31.2359167280576 -54.9688249669945, -31.2359162951314 -55.0837859279852, -31.1627591842756 -55.2196485060009, -31.079151367269 -55.2928050529227, -31.0059944145719 -55.3868636444777, -30.9014845163417 -55.5122750634389, -30.83877870305 -55.5540787291163, -30.8074260311405 -55.5122745898823, -30.6820151439647 -55.3973130122496, -30.5670547680396 -55.3973124409143, -30.3998399039485 -55.3346056434653, -30.3057810640681 -55.4286641403751, -30.1176637303557 -55.5227221795966, -30.2117220322443 -55.5749776119813, -30.2953294268025 -55.616782000566, -30.2848780587905 -55.7317428925181, -30.1803686242563 -55.731742381135, -30.0445061653162 -55.7839966931155, -30.0340550681803 -55.8258006203385, -30.1699173341337 -55.825801281543, -30.2848777110154 -55.8258018445688, -30.3266812903492 -55.8780570230441, -30.3475829827491 -55.9303120986378, -30.3580337705686 -55.9721161280218, -30.2430733967064 -55.9721155619037, -30.1072112113718 -55.9512129085078, -29.9817998896882 -55.9512122989936, -29.9713486006591 -56.0452711956169, -30.107210633035 -56.1079778211184, -30.1803670803283 -56.1497821554014, -30.2326216015293 -56.2020373821984, -30.1908175972729 -56.2647431401479, -30.3789345670158 -56.2647440690964, -30.4311896701239 -56.1602343877613, -30.5566011376069 -56.1184310356623, -30.5566009028228 -56.1811370012863, -30.5566005111185 -56.2856469426945, -30.4834434446373 -56.4110585040398, -30.3684827658877 -56.4946658807475, -30.2744238939676 -56.5991753488932, -30.211718083536 -56.6409790119459, -30.1908160038859 -56.6932338748871, -30.1908159649206 -56.7036848680763, -30.1803648276843 -56.7559397821238, -30.1385609024223 -56.7977435479189, -30.07585528689 -56.7872922460895, -30.0445023040642 -56.829096063761, -30.0967562368641 -57.0381161760673, -30.1176577695804 -57.1321752121844, -30.1908142848424 -57.1530775597912, -30.2430688762564 -57.1844307971451, -30.2848719349898 -57.3725488677523, -30.274420441813 -57.5188627044732, -30.180361733281 -57.5815681855249, -30.1699107918945 -57.5815681333967))'^^ogc:wktLiteral))"
    (= "Pantanal" (:name region)) "'Polygon((-16.2595738808171 -56.8299428181009, -16.2230668822363 -56.6595746842836, -16.1135449473282 -56.5987287080976, -16.0405304385163 -56.5013753727541, -15.9553467094181 -56.4526985990105, -15.9553469322235 -56.3431762752738, -15.9431779865509 -56.2579922182019, -15.8701632735651 -56.2579920603271, -15.797148682208 -56.1971461667324, -15.6389504226387 -56.0511160603964, -15.6876270704374 -55.965932130173, -15.8093183876838 -55.9050866504939, -15.9431787503742 -55.880748642273, -16.0161934907456 -55.8685796522922, -16.0770391610193 -55.8320723405142, -16.0892083545488 -55.7955649228069, -16.1013776472357 -55.7103809121113, -16.0161940083886 -55.6130275408281, -16.0405323461516 -55.5643509998201, -16.0648708072885 -55.4548287155643, -16.1378854513603 -55.4913363199691, -16.2109001437785 -55.5035056279769, -16.3690988708521 -55.4183219350531, -16.4664518249428 -55.4183221510207, -16.4664520769658 -55.2966306617036, -16.4421141145841 -55.1627699672405, -16.442114214972 -55.1140933701396, -16.5151288066207 -55.1749392786327, -16.5516361396525 -55.187108509268, -16.6368199748774 -55.1871087000098, -16.6368201018333 -55.126262953447, -16.6854968079522 -55.0167407176673, -16.7706806944964 -54.9924026105538, -16.782849583658 -55.1019249839296, -16.8558642467195 -55.1262634487052, -16.9653863426192 -55.1140945496419, -17.0140628177462 -55.1140946615233, -17.0505701218968 -55.138433044689, -17.1114158191973 -55.0897565872614, -17.1114160797057 -54.9680650904191, -17.1844305567313 -55.0775876072132, -17.2939525435614 -55.1140953120272, -17.4764892623606 -55.1384340422121, -17.5738422856205 -55.1019268251132, -17.6103497462755 -55.0532503133177, -17.780717475442 -55.0167432737453, -17.9024085963383 -55.0410818693688, -18.0119306521039 -55.0410821375771, -18.1701292846551 -54.9924059279951, -18.2918205094844 -54.9680679307544, -18.3526660935594 -54.9680680831818, -18.2309746479487 -55.0897592799135, -18.0971141417822 -55.1871121464309, -18.2309743705616 -55.2114507789349, -18.3161581863298 -55.2114509923213, -18.3770040200172 -55.1019287959213, -18.4256805979671 -55.0532523183099, -18.5108643568826 -55.0775908342456, -18.6082171456193 -55.1384368327944, -18.7664156531726 -55.1384372393312, -18.8515994635307 -55.1384374599282, -18.8759377808972 -55.1019300725625, -18.9489525323232 -55.07759196223, -19.0097979658774 -55.1384378727635, -19.1314890901698 -55.1506073433967, -19.3261949017258 -55.1627770114763, -19.4722240718042 -55.247961456132, -19.4965622118966 -55.2844689726197, -19.4843928603616 -55.3818221405067, -19.5209000248255 -55.4548371394106, -19.5695764513782 -55.4670064218438, -19.6182531462702 -55.369653354606, -19.7156059983974 -55.3939919215591, -19.812958697851 -55.4791762404475, -19.9346496204254 -55.5643606284228, -20.0928478157839 -55.6738834211806, -20.1293548777468 -55.7834058718508, -20.2388767980172 -55.819913632041, -20.2875532475117 -55.8199137710926, -20.3849062700418 -55.7712374515263, -20.3970754445354 -55.7468991869581, -20.4335824067444 -55.8929290885584, -20.4092440266791 -55.9537747659175, -20.3240600559566 -56.026789416906, -20.2510452596583 -56.075465804464, -20.1780305253082 -56.0998038941483, -20.117184841098 -56.1484803172099, -20.1415229107468 -56.2093261313775, -20.1050154820043 -56.2458334741381, -19.9954935038244 -56.2336640148375, -19.8859714625767 -56.2458328552394, -19.8372948298943 -56.3188476109406, -19.8372945855888 -56.4162007993011, -19.9468165638544 -56.4283702559419, -20.0928460919777 -56.3553557783984, -20.1901988620433 -56.4040326509609, -20.2632133443547 -56.4770477521708, -20.3849043946786 -56.5013864010152, -20.3970734115856 -56.5378938819141, -20.2388748407763 -56.5865700180859, -20.2267056046674 -56.6352465762685, -20.2753817990447 -56.7325999021982, -20.1901981773725 -56.6717539159367, -20.0806760202706 -56.7325993426949, -19.8738007556949 -56.8786285293764, -19.8007857796715 -57.0003197992775, -19.8007853184507 -57.182857009127, -19.8981378663493 -57.3167179028884, -20.1050125587061 -57.3897333771464, -20.2753801012134 -57.3897338708679, -20.2267041013171 -57.2193656693375, -20.2632114638252 -57.2071966279665, -20.4092407546684 -57.2193662013548, -20.4214099915624 -57.1706896474138, -20.4335786889834 -57.3288885982162, -20.470085923001 -57.3653961471187, -20.5917767311898 -57.4749188308243, -20.64045275046 -57.6331178852474, -20.7378054930786 -57.6817947637704, -20.8838347978453 -57.6817952044365, -20.9446803733161 -57.6696262423617, -20.8838350257598 -57.5966111764995, -20.9203425473861 -57.5235964051672, -20.8716665990343 -57.3410590499038, -20.9325120468897 -57.3775666758121, -21.0542028738689 -57.4749202239687, -21.0907100027896 -57.5479352185019, -21.2854157026603 -57.5601049655015, -21.4314449988403 -57.5601054199434, -21.394937508572 -57.6209510417239, -21.4436138397057 -57.6574586351167, -21.5166283852018 -57.6939663053868, -21.7600104646051 -57.7183053706253, -21.9547161760213 -57.7183059954533, -22.052069029814 -57.7183063104984, -22.0520687207525 -57.8278286346804, -22.0277303017073 -57.9008434374393, -21.9303774155391 -57.9130122690245, -21.8451937714038 -57.8765045540841, -21.6748262073015 -57.9008423029653, -21.6018116324266 -57.8765037776503, -21.5044587746052 -57.8765034701257, -21.5044586402872 -57.9251800568041, -21.2975839475052 -57.8765028223875, -21.1758929031348 -57.8643332984235, -21.0542019879417 -57.803487190825, -20.9568492856794 -57.7426411599768, -20.7743123653237 -57.8521629257715, -20.701297681378 -57.8643318523623, -20.3849008500925 -57.8643309106951, -20.3118860994256 -57.9008381345012, -20.1293494904544 -57.8886684553172, -19.8737981858852 -57.8886677189275, -19.7399379752455 -57.8886673377463, -19.5208943255125 -57.7548061148483, -19.4357103063234 -57.8521590453588, -19.5208939890353 -57.8886667206983, -19.4843865656865 -57.9251740561488, -19.2044970786206 -57.9008349897453, -19.119313600918 -57.7791432985935, -19.0462990519307 -57.7304665163555, -18.6568875313157 -57.7061271814936, -18.5230272959236 -57.7061268288932, -18.3526600365921 -57.5722657800722, -18.1457850576596 -57.5966035394717, -17.9389099898476 -57.6574487426947, -17.8415569416877 -57.7182942256655, -17.6468510122379 -57.766970321756, -17.3304535844072 -57.9738450122629, -17.208762172517 -58.0955361652611, -17.0749014859489 -58.2902421549432, -16.8436881856236 -58.3510873251527, -16.6854897530489 -58.3267486647764, -16.6246443913219 -58.2293953691493, -16.5394605619106 -58.2415643157814, -16.4299383978007 -58.3024097841271, -16.4056000639634 -58.3510863044632, -16.2960781071388 -58.3145786220726, -16.2717396446001 -58.4241008621619, -16.2960777450495 -58.4849466366052, -16.296077278497 -58.7039912208741, -16.3325841791928 -58.9108667392836, -16.308245690506 -59.0325581128506, -16.2717380883497 -59.1542494563999, -16.1257087470266 -59.1420799805815, -16.0526942420971 -59.0568958167075, -15.9675106456605 -58.9595424828632, -15.9066652756722 -58.8621892034582, -15.857989018556 -58.7648359506088, -15.797143442939 -58.7648358159432, -15.6876213305186 -58.8013430042385, -15.6511140095405 -58.7891737812774, -15.6389451186346 -58.6796514664299, -15.7849748306057 -58.5214529223835, -15.9310045703772 -58.3510852332932, -16.0161885569349 -58.2659014151961, -15.8093138646352 -58.1320403722044, -15.711961158808 -58.0225178610021, -15.541593698605 -57.9373334818662, -15.5294245817371 -57.9373334557365, -15.5294247780366 -57.8399802996573, -15.7971454725697 -57.7791351556006, -15.9796822711674 -57.7547972672004, -16.0283589135391 -57.669613360398, -16.1257120985669 -57.5479221254996, -16.1743887424105 -57.4627382168501, -16.2595728131036 -57.341046952463, -16.2230656665717 -57.2436937049511, -16.1135437152768 -57.1950168777078, -16.0283598952449 -57.1950166892724, -16.0040217108981 -57.1706783440102, -16.0040217860573 -57.134170906413, -16.1135439926146 -57.0611562723663, -16.174389679895 -57.0124798230097, -16.125713386992 -56.9272956915387, -16.2230664273442 -56.8786193224131, -16.2352359494196 -56.6839130047843, -16.2595738808171 -56.8299428181009))'^^ogc:wktLiteral))"
    (= "Pico da Neblina National Park" (:name region)) "'Polygon((1.03661639143801 -66.7897018977834, 0.93034198336955 -66.802986198792, 0.86834857866294 -66.8782639045071, 0.868348578662947 -66.9136887071966, 0.775358471603042 -66.85169530249, 0.748789869585926 -66.873835804171, 0.545097254121372 -66.8384110014815, 0.000440912770501 -66.8428391018176, -0.008415287901872 -66.1299149476917, -0.070408692608475 -66.1431992487003, -0.083692993617033 -66.0944901450022, -0.154542598996008 -66.0989182453384, -0.247532706055913 -66.0502091416404, -0.247532706055913 -65.9837876365976, -0.203251702694053 -65.9439347335719, -0.260817007064471 -65.8863694292015, -0.243104605719727 -65.780095021133, -0.30509801042633 -65.6959611147455, -0.287385609081586 -65.4701279976, -0.358235214460562 -65.3328568871782, -0.411372418494793 -65.2000138770927, -0.336094712779632 -65.1424485727222, -0.30509801042633 -65.0848832683518, -0.256388906728285 -65.0760270676795, -0.216536003702611 -65.0804551680157, -0.194395502021681 -65.0760270676795, -0.136830197651264 -65.0981675693604, -0.088121093953218 -65.1158799707051, -0.065980592272289 -65.1114518703689, -0.030555789582801 -65.0804551680157, 0.027009514787616 -65.0538865659985, 0.089002919494219 -65.0317460643176, 0.150996324200823 -65.04060226499, 0.217417829243612 -65.0361741646538, 0.292695534958773 -65.0273179639814, 0.341404638656819 -65.0317460643176, 0.381257541682492 -65.0715989673433, 0.536241053449001 -65.0450303653262, 0.660227862862207 -65.0494584656623, 0.708936966560253 -65.0317460643176, 0.735505568577368 -65.0848832683518, 0.7886427726116 -65.0760270676795, 0.841779976645831 -65.1513047733946, 0.81078327429253 -65.2132981781012, 0.828495675637273 -65.2398667801183, 0.921485782697178 -65.2221543787736, 0.961338685722852 -65.2487229807907, 0.961338685722852 -65.2974320844887, 0.939198184041922 -65.3461411881868, 0.850636177318203 -65.3948502918849, 0.797498973283972 -65.421418893902, 0.735505568577368 -65.4258469942381, 0.700080765887881 -65.4656998972638, 0.682368364543137 -65.5276933019704, 0.695652665551695 -65.5586900043237, 0.735505568577368 -65.5764024056685, 0.779786571939228 -65.5276933019704, 0.828495675637273 -65.4966965996171, 0.886060980007691 -65.4745560979362, 0.934770083705736 -65.4922684992809, 0.979051087067596 -65.5144090009619, 1.02333209042946 -65.5631181046599, 1.02333209042946 -65.6339677100389, 1.02333209042946 -65.6826768137369, 0.992335388076154 -65.780095021133, 0.979051087067596 -65.7978074224778, 0.956910585386666 -65.8598008271844, 0.956910585386666 -65.9040818305462, 0.917057682360992 -65.921794231891, 0.877204779335319 -65.9483628339081, 0.846208076982017 -65.9837876365976, 0.837351876309645 -66.0059281382785, 0.828495675637273 -66.0147843389509, 0.815211374628716 -66.0723496433213, 0.7886427726116 -66.0856339443299, 0.770930371266856 -66.1299149476917, 0.784214672275414 -66.160911650045, 0.806355173956343 -66.1830521517259, 0.797498973283972 -66.2273331550878, 0.775358471603042 -66.3247513624839, 0.828495675637273 -66.3690323658458, 0.868348578662947 -66.4177414695438, 0.921485782697178 -66.4885910749228, 0.987907287739968 -66.5373001786208, 1.01890399009327 -66.6170059846722, 1.03661639143801 -66.7897018977834))'^^ogc:wktLiteral))"
  )
)

;;--------------------------------------
;; Handlers
(defn handler-statistics [response]
 (let [result (-> (comps/json->clj response) (get "results") (get "bindings") (get 0))]
       (reset! stat {
                :ocurrences (-> result (get "Ocurrences") (get "value"))
                :species (-> result (get "Species") (get "value"))
                :animalia (-> result (get "Animalia") (get "value"))
                :plantae (-> result (get "Plantae") (get "value"))
                :geo-referenced (-> result (get "Georeference") (get "value"))}) ))

(defn handler-statistics-data-sets [response]
 (let [result (-> (comps/json->clj response) (get "results") (get "bindings") (get 0))]
   (reset! progress-data-sets "none")
   (comps/draw-charts "chart-data-sets" "" [["Embrapa" (-> result (get "Embrapa") (get "value") (int))]
                                            ["IUCN" (-> result (get "IUCN") (get "value") (int))]
                                            ["INPA" (-> result (get "INPA") (get "value") (int))]
                                            ["SpeciesLink" (-> result (get "SpeciesLink") (get "value") (int))] ] 3) ))

(defn handler-statistics-years [response]
  (let [result (-> (comps/json->clj response) (get "results") (get "bindings"))
        list (atom []) ]
        (reset! progress-years "none")
        (dotimes [i (count result)]
          (reset! list (conj @list [(-> result (get i) (get "year") (get "value"))
                                    (-> result (get i) (get "yearCT") (get "value") (int))])))
        (comps/draw-charts "chart-years" "" @list 3) ))

(defn handler-statistics-country [response]
  (let [result (-> (comps/json->clj response) (get "results") (get "bindings"))
        list (atom []) ]
    (reset! progress-country "none")
    (dotimes [i (count result)]
      (reset! list (conj @list [(-> result (get i) (get "Country") (get "value") (clojure.string/replace "http://dbpedia.org/resource/" ""))
                                (-> result (get i) (get "CountryST") (get "value") (int))])))
    (comps/draw-charts "chart-country" "" @list 4) ))

;;--------------------------------------
;; Consult Functions

(defn consult-statistics []
  (ajax/POST (str "http://java.icmc.usp.br:2190/repositories/" "Animalia") {
    :format :raw
    :params {
      :query (clojure.string/replace
                (str prefix "SELECT (COUNT(?code) as ?Ocurrences) (COUNT(DISTINCT ?species) as ?Species)
                    (sum(if(lcase(str(?kingdom)) = 'animalia', 1, 0)) as ?Animalia)
                    (sum(if(lcase(str(?kingdom)) = 'plantae', 1, 0)) as ?Plantae)
                    (COUNT(?wktA) as ?Georeference){
                      ?code dwc:scientificName ?species.
                      ?code geo:hasGeometry/geo:asWKT ?wktA.
                      ?code dwc:kingdom ?kingdom.
                    }") #"#" "%23")}
    :handler handler-statistics
    :error-handler (fn [response] (js/console.log response))
    }) )

(defn consult-statistics-data-sets []
  (ajax/POST (str "http://java.icmc.usp.br:2190/repositories/" "Animalia") {
    :format :raw
    :params {:query (clojure.string/replace "PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                                            PREFIX dwc: <http://rs.tdwg.org/dwc/terms/>
                                            SELECT (sum(if(lcase(str(?biospecie)) = 'http://java.icmc.usp.br/specieslink/biospecie', 1, 0)) as ?SpeciesLink)
                                            (sum(if(lcase(str(?biospecie)) = 'http://java.icmc.usp.br/iucn/biospecie', 1, 0)) as ?IUCN)
                                            (sum(if(lcase(str(?biospecie)) = 'http://java.icmc.usp.br/inpa/biospecie', 1, 0)) as ?INPA)
                                            (sum(if(lcase(str(?biospecie)) = 'http://java.icmc.usp.br/embrapa/biospecie', 1, 0)) as ?Embrapa)
                                            {  ?code rdf:type ?biospecie
                                            } " #"#" "%23")}
    :handler handler-statistics-data-sets
    :error-handler (fn [response] (js/console.log response))
    }) )

(defn consult-statistics-years []
  (ajax/POST (str "http://java.icmc.usp.br:2190/repositories/" "Animalia") {
    :params {
      :query (clojure.string/replace
                (str prefix "Select ?year (COUNT(?year) as ?yearCT)
                            where {
                                ?code prov:hadMember/bioprov:wasCollectedBy/bioprov:yearcollected ?yearcollected.
                                bind( substr( str(?yearcollected), 1, 4) as ?year )
                                FILTER(!isBlank(?year))
                            } GROUP BY ?year
                            ORDER BY ?year
                            ") #"#" "%23")}
    :handler handler-statistics-years
    :error-handler (fn [response] (js/console.log response))
    }) )

(defn consult-statistics-country []
  (ajax/POST (str "http://java.icmc.usp.br:2190/repositories/" "Animalia") {
    :format :raw
    :params {
      :query "PREFIX dwc: <http://rs.tdwg.org/dwc/terms/>
              SELECT ?Country (COUNT(?Country) as ?CountryST) {
                ?code dwc:country ?Country.
              } GROUP BY ?Country
                Order by ?Country"}
    :handler handler-statistics-country
    :error-handler (fn [response] (js/console.log response))
    }) )

(defn handler [response]
  (if (nil? (:status response))
    (do
      (def response-json (comps/json->clj response))
      (reset! responseAtom (-> response-json (get "results") (get "bindings")) )
      (reset! data-table (comps/create-table-geobio @responseAtom))
      (def msize (count @responseAtom))
      (if (> msize 0) (response-to-csv @responseAtom) (do (reset! csv-file nil) (reset! rdf-describe nil)) )
      (remove-markers)
      (reset! markers-spyder (js/OverlappingMarkerSpiderfier. @mymap (clj->js {"keepSpiderfied" true "event" "mouseover"})))
      (.addListener @markers-spyder "format" (fn [marker status] (if (= 0 (compare status "SPIDERFIED"))
                                                                   (.setIcon marker (clj->js {:url "imgs/markers/marker-highlight.svg" :scaledSize (js/google.maps.Size. 23 32)}))
                                                                   (if (= 0 (compare status "SPIDERFIABLE"))
                                                                       (.setIcon marker (clj->js {:url "imgs/markers/marker-plus.svg" :scaledSize (js/google.maps.Size. 23 32)}))
                                                                       (if (= 0 (compare status "UNSPIDERFIABLE"))
                                                                           (.setIcon marker (clj->js {:url "imgs/markers/marker.svg" :scaledSize (js/google.maps.Size. 23 32)})) )))  ))
      (dotimes [i msize]
        (let [latlng (-> @responseAtom (get i) (get "pontowkt") (get "value") (clojure.string/replace "POINT(" "") (clojure.string/replace ")" "") (clojure.string/split " ") )
              scientificName (-> @responseAtom (get i) (get "scientificname") (get "value"))
              institutionCode (-> @responseAtom (get i) (get "institutionCode") (get "value"))
              dateCollected (-> @responseAtom (get i) (get "dateCollected") (get "value"))
              nameCollected (-> @responseAtom (get i) (get "nameCollected") (get "value"))
              dateCataloguing (-> @responseAtom (get i) (get "dateCataloguing") (get "value"))
            ]
            (create-marker @mymap
              (get latlng 0)
              (get latlng 1)
              (str (+ i 1) ": " scientificName)
              (str "<div><p style='font-weight: bold;'>BioProv Provenance</p>"
                   "<p>Scientific name: " scientificName " (<a href='#" (+ i 1) "'>" (+ i 1) "</a>) <br>"
                   "Institution code: " institutionCode "<br>"
                   "Date collected: " dateCollected "<br>"
                   "Name collected: " nameCollected "<br>"
                   "Date cataloguing: " dateCataloguing "</p></div>") )
        )
      )
      (reset! markers-cluster (js/MarkerClusterer. @mymap @mymarkers (clj->js {"imagePath" "https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m"})))
      (.setMaxZoom @markers-cluster 12)
      (.setZoom @mymap 4)
      (reset! qb-expand true)
      (let [polygon-wkt (region-polygon (first (filter #(:checked %) (:regions @list-state))))
            points (-> polygon-wkt (clojure.string/replace "'Polygon((" "") (clojure.string/replace "))'^^ogc:wktLiteral))" "") (clojure.string/split ","))
            array-cords (atom [])]
            (dotimes [i (count points)]
              (let [latlng (clojure.string/split  (clojure.string/trim (get points i)) " ")]
                (swap! array-cords conj {:lat (js/parseFloat (get latlng 0)) :lng (js/parseFloat (get latlng 1))} )
              )
            )
            (create-polygon mymap @array-cords obj-polygon)
      )
      (if-not (nil? (second (filter #(:checked %) (:regions @list-state))))
        (let [polygon-wkt (region-polygon (second (filter #(:checked %) (:regions @list-state))))
              points (-> polygon-wkt (clojure.string/replace "'Polygon((" "") (clojure.string/replace "))'^^ogc:wktLiteral))" "") (clojure.string/split ","))
              array-cords (atom [])]
              (dotimes [i (count points)]
                (let [latlng (clojure.string/split  (clojure.string/trim (get points i)) " ")]
                  (swap! array-cords conj {:lat (js/parseFloat (get latlng 0)) :lng (js/parseFloat (get latlng 1))} )
                )
              )
              (create-polygon mymap @array-cords obj-polygon2)
        )
        (if-not (nil? @obj-polygon2)
                (do
                  (.setMap @obj-polygon2 (clj->js nil))
                  (reset! obj-polygon2 nil)) )
      )
      (reset! qb-progress false)
    )
    (do
      (reset! responseAtom {})
      (reset! data-table "")
      (remove-markers)
      (reset! markers-spyder nil)
      (reset! markers-cluster nil)
      (reset! qb-expand false)
      (if-not (nil? @obj-polygon)
              (.setMap @obj-polygon (clj->js nil)) )
      (reset! obj-polygon nil)
      (if-not (nil? @obj-polygon2)
              (.setMap @obj-polygon2 (clj->js nil)) )
      (reset! obj-polygon2 nil)
      (let [polygon-wkt (region-polygon (first (filter #(:checked %) (:regions @list-state))))
            points (-> polygon-wkt (clojure.string/replace "'Polygon((" "") (clojure.string/replace "))'^^ogc:wktLiteral))" "") (clojure.string/split ","))
            array-cords (atom [])]
            (dotimes [i (count points)]
              (let [latlng (clojure.string/split  (clojure.string/trim (get points i)) " ")]
                (swap! array-cords conj {:lat (js/parseFloat (get latlng 0)) :lng (js/parseFloat (get latlng 1))} )
              )
            )
            (create-polygon mymap @array-cords obj-polygon)
      )
      (if-not (nil? (second (filter #(:checked %) (:regions @list-state))))
        (let [polygon-wkt (region-polygon (second (filter #(:checked %) (:regions @list-state))))
              points (-> polygon-wkt (clojure.string/replace "'Polygon((" "") (clojure.string/replace "))'^^ogc:wktLiteral))" "") (clojure.string/split ","))
              array-cords (atom [])]
              (dotimes [i (count points)]
                (let [latlng (clojure.string/split  (clojure.string/trim (get points i)) " ")]
                  (swap! array-cords conj {:lat (js/parseFloat (get latlng 0)) :lng (js/parseFloat (get latlng 1))} )
                )
              )
              (create-polygon mymap @array-cords obj-polygon2)
        )
        (if-not (nil? @obj-polygon2)
                (do
                  (.setMap @obj-polygon2 (clj->js nil))
                  (reset! obj-polygon2 nil)) )
      )
      (reset! qb-progress false)
      (reset! qb-expand false)
      (js/alert "No records found!")
    )
  )
)

(defn consult [serv query]
  (reset! qb-expand false)
  (reset! data-table "")
  (ajax/POST (str "http://java.icmc.usp.br:2190/repositories/" serv) {
    :format :raw
    :params {
      :query  (clojure.string/replace query #"#" "%23")}
    :handler handler
    :error-handler handler
  })
)

;;---------------------------------

(defn drawer-click [] "Open drawer"
  (swap! drawer-status [true false])
  (if (= @statitics-bol false)
    (do (consult-statistics)
        (consult-statistics-data-sets)
        (consult-statistics-years)
        (consult-statistics-country)
        (reset! statitics-bol true)) ) )

(defn create-query []
  (if (nil? (first (filter #(:checked %) (:properties @list-state))))
      (js/alert "No property selected!")
      (if (nil? (first (filter #(:checked %) (:regions @list-state))))
          (js/alert "No region selected!")
          (let [query (atom prefix)
                str-filter (atom "")
                start-date (-> (js/document.getElementById "start-date") (.-value))
                end-date (-> (js/document.getElementById "end-date") (.-value))]

                  (swap! query str "SELECT ?CodSpecie ?scientificname ?occurrenceStatusIUCN ?pontowkt ?institutionCode ?country ?dateCollected ?nameCollected ?nameCataloguing ?kingdom ?phylum ?class ?order ?family ?genus \n")
                  (swap! query str "WHERE { \n" (if-not (nil? (first (filter #(:checked %) (:species @list-state))))
                                                        (str "\t?CodSpecie dwc:scientificName '" (:name (first (filter #(:checked %) (:species @list-state)))) "' .\n")
                                                        "" )
                                   "\t?CodSpecie dwc:scientificName ?scientificname . \n"
                                   "\t?CodSpecie geo:hasGeometry/geo:asWKT ?pontowkt . \n"
                                   "\t?CodSpecie dwc:institutionCode ?institutionCode . \n"
                                   "\t?CodSpecie prov:hadMember/bioprov:wasCollectedBy/prov:startedAtTime ?dateCollected . \n"
                                   "\t?CodSpecie prov:hadMember/bioprov:wasCatalguingBy/prov:startedAtTime ?dateCataloguing. \n"
                                   "\t?CodSpecie prov:hadMember/bioprov:wasCollectedBy/prov:wasAssociatedWith/foaf:givenName ?nameCollected. \n"
                                   "\t?CodSpecie prov:hadMember/bioprov:wasCatalguingBy/prov:wasAssociatedWith/foaf:givenName ?nameCataloguing. \n"
                                   "\t?CodSpecie prov:hadMember/bioprov:wasCollectedBy/bioprov:yearcollected ?yearcollected. \n"
                                   "\t?CodSpecie dwc:kingdom ?kingdom. \n"
                                   "\t?CodSpecie dwc:phylum ?phylum. \n"
                                   "\t?CodSpecie dwc:class ?class. \n"
                                   "\t?CodSpecie dwc:order ?order. \n"
                                   "\t?CodSpecie dwc:family ?family. \n"
                                   "\t?CodSpecie dwc:genus ?genus. \n"
                                   "\tOPTIONAL { ?CodSpecie dwc:country ?country. } \n"
                                   "\tOPTIONAL { ?CodSpecie bioprov:hasConservationStatus/dwc:occurrenceStatus ?occurrenceStatusIUCN1.} \n"
                                   "\tOPTIONAL { ?CodSpecie dwc:occurrenceStatus ?occurrenceStatusIUCN2. } \n"
                                   "\tBIND(COALESCE(?occurrenceStatusIUCN1, ?occurrenceStatusIUCN2) as ?occurrenceStatusIUCN) \n")

                  #_(doall ;;caso use mais de 1 specie
                    (let [i (atom 0)]
                      (for [element (:species @list-state) :when (:checked element)]
                        (do (if (= 0 @i) (swap! query str "\tFILTER ("))
                            (swap! i inc)
                            (swap! query str "?scientificname = '" (:name element) "' " (if (not= @i (count (filter #(:checked %) (:species @list-state)))) "|| " ")\n"))
                        ))))
                  (let [propertie (first (filter #(:checked %) (:properties @list-state)))]
                    (cond (= "Within" (:name propertie)) (reset! str-filter "\tFILTER (geof:sfWithin(?pontowkt, "  )
                          (= "Intersects" (:name propertie)) (reset! str-filter "\tFILTER (geof:sfIntersects(?pontowkt, "  ) )
                  )
                  (let [regions (filter #(:checked %) (:regions @list-state))]
                    (swap! query str @str-filter (region-polygon (first regions)))
                    (if-not (nil? (second regions))
                            (swap! query str "\n" @str-filter (region-polygon (second regions))) )
                  )
                  (if-not (clojure.string/blank? start-date) (swap! query str "\n\tFILTER (?dateCollected >= '" start-date "'^^xsd:dateTime )") )
                  (if-not (clojure.string/blank? end-date) (swap! query str "\n\tFILTER (?dateCollected <= '" end-date "'^^xsd:dateTime )" ) )
                  (swap! query str "\n} ORDER BY ?scientificname")
                  (reset! app-state (assoc-in @app-state [:sparql-query] @query))
                  (reset! yasqe (comps/yasqe (:sparql-query @app-state)))
                  (reset! qb-progress true)
                  (consult "Animalia" (:sparql-query @app-state))

      )
    )
  )
)

(defn query-builder []
  [:div
    [:div {:class "row" }
      [:div {:class "col-md-12 col-lg-12"}
        [:p {
          :style {
            :font-size "1.3rem"
            :color (color :deep-purple800)}}
          "Return occurrences of "
          [:span {
            :style {
              :color "black"}} "<#Species>"]
          " that are "
          [:span {
            :style {
              :color "black"}} "<#Property>"]
          " in the "
          [:span {
            :style {
              :color "black"}} "<#Region>"]]]
      [:div {:class "col-md-4  col-lg-4" :style {:padding-bottom "15px"}}
        [rui/paper {:zDepth 2 :style {:padding "5px"}}
          [rui/date-picker {:id "start-date"
                            :key "start-date"
                            :placeholder "Start date"
                            :textFieldStyle {
                              :max-width "100%"}
                            :container "inline"
                            :maxDate (time/now)
                            :minDate (time/date-time 1750 1 1)
                            :value @start-datePicker
                            :onChange (fn [null date] (reset! start-datePicker date))
                            :cancelLabel "Clear"
                            :onDismiss (fn [] (reset! start-datePicker "") ) }] ]]
      [:div {:class "col-md-4 col-lg-4 col-md-offset-4 col-lg-offset-4" :style {:padding-bottom "15px"}}
        [rui/paper {
          :zDepth 2
          :style {
            :padding "5px"}}
          [rui/date-picker {
            :id "end-date"
            :key "end-date"
            :placeholder "End date"
            :textFieldStyle {
              :max-width "100%"}
            :container "inline"
            :maxDate (time/now)
            :minDate (time/date-time 1750 1 1)
            :value @end-datePicker
            :onChange (fn [null date] (reset! end-datePicker date))
            :cancelLabel "Clear"
            :onDismiss (fn [] (reset! end-datePicker "") ) }] ]]
      [:div {:class "col-md-4 col-lg-4"}
        [rui/paper {
          :zDepth 2
          :style {
            :padding "5px"
            :min-height "100px"}}
          [comps/combo-select-list "species" list-state 1 false]]]
      [:div {:class "col-md-4"}
        [rui/paper {
          :zDepth 2
          :style {
            :padding "5px"
            :min-height "100px"}}
          [comps/combo-select-list "properties" list-state 1 false]]]
      [:div {:class "col-md-4"}
        [rui/paper {
          :zDepth 2
          :style {
            :padding "5px"
            :min-height "100px"}}
          [comps/combo-select-list "regions" list-state 2 false]]]
    ]
  ]
)


(defn interface []
  [:div
    [rui/mui-theme-provider mui-conf
      [rui/drawer {
        :open @drawer-status
        :id "drawer"
        :width "100%"
        :style {:background-color (color :grey50)}}
        [rui/app-bar {
          :title "Close"
          :icon-element-left (reagent/as-element
                                [rui/icon-button (ic/navigation-close)])
          :onLeftIconButtonTouchTap (fn [e] (drawer-click) ) }]
        [:div {
          :class "row"
          :style {
            :margin-right "0px"
            :margin-left "0px"
            :padding-top "10px"}}
          [:div {:class "col-lg-3"}
            [rui/card {
              :style {
                :height "400px"
                :border-radius "15px"
                :overflow "hidden"}}
              [rui/card-title {
                :title "Data metrics"
                :act-as-expander false
                :titleColor "white"
                :style {
                  :background-color (color :orange700)} }]
              [rui/card-text
                [rui/list
                  [rui/list-item {
                    :value 0
                    :key 0
                    :left-icon (ic/social-public {:style {:fill (color :indigo700)}})
                    :primary-text (str "Ocurrences: " (get @stat :ocurrences)) }]
                  [rui/divider]
                  [rui/list-item {
                    :value 1
                    :key 1
                    :left-icon (ic/notification-adb {:style {:fill (color :brown700)}})
                    :primary-text (str "Species: " (get @stat :species)) }]
                  [rui/divider]
                  [rui/list-item {
                    :value 2
                    :key 2
                    :left-icon (ic/action-bug-report {:style {:fill (color :orange700)}})
                    :primary-text (str "Animalia: " (get @stat :animalia)) }]
                  [rui/divider]
                  [rui/list-item {
                    :value 3
                    :key 3
                    :left-icon (ic/maps-local-florist {:style {:fill (color :green700)}})
                    :primary-text (str "Plantae: " (get @stat :plantae)) }]
                  [rui/divider]
                  [rui/list-item {
                    :value 4
                    :key 4
                    :left-icon (ic/maps-place {:style {:fill (color :red700)}})
                    :primary-text (str "Georeferenced: " (get @stat :geo-referenced)  ) }] ] ]]  ]
          [:div {:class "col-lg-3"}
            [rui/card {
              :style {
                :height "400px"
                :border-radius "15px"
                :overflow "hidden"}}
              [rui/card-title {
                :title "Datasets"
                :act-as-expander false
                :titleColor "white"
                :style {
                  :background-color (color :green700)}}]
              [rui/card-text
                [rui/circular-progress {
                  :size 60
                  :style {
                    :top "50px"
                    :left "calc(50% - 50px)"
                    :display @progress-data-sets}}]
                [:div {
                  :id "chart-data-sets"
                  :style {
                    :height "300px"}}] ] ] ]
          [:div {:class "col-lg-3"}
            [rui/card {
              :style {
                :height "400px"
                :border-radius "15px"
                :overflow "hidden"}}
            [rui/card-title {
              :title "Ocurrences in South America"
              :act-as-expander false
              :titleColor "white"
              :style {
                :background-color (color :deep-purple500)} }]
            [rui/card-text
              [rui/circular-progress {
                :size 60
                :style {
                  :top "50px"
                  :left "calc(50% - 50px)"
                  :display @progress-country}}]
              [:div {
                :id "chart-country"
                :style {
                  :max-height "250px"}}] ] ] ]
          [:div {:class "col-lg-3"}
            [rui/card {
              :style {
                :height "400px"
                :border-radius "15px"
                :overflow "hidden"}}
            [rui/card-title {
              :title "Occurrences by year collected"
              :act-as-expander false
              :titleColor "white"
              :style {
                :background-color (color :cyan700)} }]
            [rui/card-text
              [rui/circular-progress {
                :size 60
                :style {
                  :top "50px"
                  :left "calc(50% - 50px)"
                  :display @progress-years}}]
              [:div {
                :id "chart-years"
                :style {
                  :max-height "250px"}}] ] ] ]
        ]
      ]
    ]

    [:div#app-bar
      [rui/mui-theme-provider mui-conf
        [rui/app-bar {
          :title "STBioData Query Builder"
          :titleStyle {:text-align "center"}
          :style {
            :position "fixed"
            :top 0
            :left 0 }
          :icon-element-right (reagent/as-element [rui/flat-button {
                                                    :label "Endpoint"
                                                    :label-position "before"
                                                    :icon (ic/action-open-in-new)
                                                    :style {:color "white"}} ])
          :on-Right-Icon-Button-Touch-Tap (fn [e] (.open js/window "http://java.icmc.usp.br:2190/sparql" "_blank") )
          :icon-element-left (reagent/as-element [rui/flat-button {
                                                    :label "Statistics"
                                                    :label-position "after"
                                                    :icon (ic/navigation-menu)
                                                    :style {:color "white"}} ])
          :on-Left-Icon-Button-Touch-Tap (fn [e] (drawer-click) )
          }]]
      [:div#app-content.row {
        :style {
          :max-width "100%"
          :margin-left "0px"
          :margin-right "0px"
          :margin-top "65px" }}
        [:div {:class "col-md-7 col-lg-7" }
          [rui/mui-theme-provider {:mui-theme (get-mui-theme {:palette {:primary1-color (color :deep-purple500)}})}
            [rui/card {
              :expanded @qb-expand
              :style {
                :margin "5px"
                :border-radius "15px"
                :overflow "hidden"
                :background-color (color :grey-100)}}
              [rui/card-header {
                :title "Query Builder"
                :children (reagent/as-element
                            [rui/icon-button {
                              :on-click (fn [] (swap! qb-expand [true false]))
                              :children (ic/action-code {:color "white"})
                              :style {
                                :position "absolute"
                                :right 0
                                :top 0}} ])
                :titleColor "white"
                :style {:background-color (color :deep-purple500)} }]
              [rui/card-text {
                :style {:background-color (color :grey100)}}
                [query-builder]]
              [rui/card-actions {
                :style {
                  :text-align "right"
                  :padding-right "1rem"
                  :padding-left "1rem"}}
                [:div
                  [rui/circular-progress {
                    :size 30
                    :thickness 3
                    :style {
                      :position "relative"
                      :top "7px"
                      :right "5px"
                      :visibility (if @qb-progress "visible" "hidden")}}]
                  [rui/raised-button {
                    :label "Create Query"
                    :background-color (color :deep-purple400)
                    :label-color "#FFFFFF"
                    :on-click #_(consult-test) #(create-query)}]] ]
              [rui/card-media {
                :expandable true
                }
                [@yasqe]]
            ]
          ]
        ]
        [:div {:class "col-md-5 col-lg-5"}
          [rui/mui-theme-provider mui-conf
            [rui/card {
              :style {
                :margin "5px"
                :border-radius "15px"
                :overflow "hidden"
                :background-color (color :grey-100)}}
              [rui/card-header {
                :title "Map"
                :titleColor "white"
                :style {
                  :background-color (color :orange500)} }]
              [rui/card-media
                [create-map]] ]]
        ]
        [:div {:class "col-md-12 col-lg-12"}
          [rui/mui-theme-provider mui-conf
            [rui/card {
              :style {
                :margin "5px"
                :border-radius "15px 15px 0px 0px"
                :overflow "hidden"
                :background-color (color :grey-100)}}
              [rui/card-header {
                :title "Result"
                :titleColor "white"
                :style {
                  :background-color (color :blue500)}
              }]
              [rui/card-actions {
                :style {
                  :text-align "right"
                  :padding-right "1rem"
                  :padding-left "1rem"}}
                [rui/circular-progress {
                  :size 30
                  :thickness 3
                  :color (color :blue400)
                  :style {
                    :position "relative"
                    :top "7px"
                    :right "5px"
                    :visibility (if @download-progress "visible" "hidden")}}]
                [rui/icon-menu {
                  :icon-button-element (reagent/as-element
                                          [rui/raised-button {
                                            :label "Download"
                                            :label-position "after"
                                            :icon (ic/file-cloud-download)
                                            :background-color (color :blue400)
                                            :label-color "#FFFFFF" }])
                  :children [(reagent/as-element
                                [rui/menu-item {
                                  :value "1"
                                  :primary-text "CSV Format"
                                  :on-click (fn [] (download-csv) ) }])
                             (reagent/as-element
                                [rui/menu-item {
                                  :value "2"
                                  :primary-text "RDF Format"
                                  :on-click (fn [] (download-rdf))}]) ]
                  }]]
              [rui/card-text
                [:div @data-table]]
            ]]
        ]
      ]
    ]
  ]
)

;;--------------------------
;; Views

(defn home-page []
  (interface))
;; -------------------------
;; Initialize app

(defn mount-root []
  (consult-species-list)
  (reagent/render [home-page] (.getElementById js/document "app")
  (.load js/google.charts "current" (clj->js {:packages ["corechart"]}))))

(defn init! []
  (mount-root))
